<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔄 Rigid Body Mechanics - Interactive Physics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #4a5568 100%);
            color: #ffffff;
            min-height: 100vh;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #63b3ed;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .intro {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #63b3ed;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 30px 0;
        }
        
        .three-column {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(99, 179, 237, 0.3);
        }
        
        .physics-simulator {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #63b3ed;
            border-radius: 10px;
            height: 400px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .rigid-body {
            position: absolute;
            border: 3px solid #ed8936;
            background: rgba(237, 137, 54, 0.3);
            transition: all 0.05s ease;
        }
        
        .angular-velocity-vector {
            position: absolute;
            border: 3px solid #48bb78;
            transform-origin: 0 50%;
        }
        
        .angular-velocity-vector::after {
            content: '';
            position: absolute;
            right: -8px;
            top: -6px;
            width: 0;
            height: 0;
            border-left: 12px solid #48bb78;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }
        
        .torque-vector {
            position: absolute;
            border: 3px solid #e53e3e;
            transform-origin: 0 50%;
        }
        
        .torque-vector::after {
            content: '';
            position: absolute;
            right: -8px;
            top: -6px;
            width: 0;
            height: 0;
            border-left: 12px solid #e53e3e;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }
        
        .principal-axis {
            position: absolute;
            border: 2px dashed #805ad5;
            opacity: 0.7;
        }
        
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        .equation-box {
            background: rgba(99, 179, 237, 0.1);
            border: 2px solid #63b3ed;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .theory-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 4px solid #ed8936;
        }
        
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .concept-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #48bb78;
        }
        
        .tensor-visualization {
            background: rgba(128, 90, 213, 0.1);
            border: 2px solid #805ad5;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .gyroscope-demo {
            background: rgba(72, 187, 120, 0.1);
            border: 2px solid #48bb78;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #63b3ed, #4299e1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 179, 237, 0.4);
        }
        
        .math-container {
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .visualization-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .inertia-ellipsoid {
            position: absolute;
            border: 2px solid #805ad5;
            border-radius: 50%;
            opacity: 0.6;
        }
        
        @media (max-width: 768px) {
            .demo-grid, .three-column {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔄 Rigid Body Mechanics</h1>
        
        <div class="intro">
            <h3>🎯 Exploring Rotational Dynamics and Angular Motion</h3>
            <p><strong>Rigid Body Mechanics</strong> extends classical mechanics to objects that maintain their shape while rotating. Unlike point particles, rigid bodies have orientation and angular momentum, leading to rich rotational dynamics governed by moment of inertia tensors and Euler's equations.</p>
            
            <p>Key mathematical concepts include:</p>
            <ul>
                <li><strong>Moment of Inertia Tensor:</strong> \(I_{ij} = \int \rho(\mathbf{r}) (r^2 \delta_{ij} - r_i r_j) d\mathbf{r}\)</li>
                <li><strong>Angular Momentum:</strong> \(\mathbf{L} = I \boldsymbol{\omega}\)</li>
                <li><strong>Euler's Equations:</strong> \(I_1 \dot{\omega}_1 = (I_2 - I_3)\omega_2 \omega_3 + \tau_1\)</li>
                <li><strong>Gyroscopic Precession:</strong> \(\boldsymbol{\Omega} = \frac{\boldsymbol{\tau}}{|\mathbf{L}|}\)</li>
            </ul>
        </div>

        <div class="theory-section">
            <h2>📚 Mathematical Foundation</h2>
            
            <div class="concept-grid">
                <div class="concept-card">
                    <h3>🎯 Moment of Inertia Tensor</h3>
                    <p>The moment of inertia tensor \(\mathbf{I}\) characterizes how mass is distributed relative to rotation axes:</p>
                    <div class="equation-box">
                        \[I_{ij} = \int \rho(\mathbf{r}) (r^2 \delta_{ij} - r_i r_j) d\mathbf{r}\]
                    </div>
                    <p>For discrete masses: \(I_{ij} = \sum_k m_k (r_k^2 \delta_{ij} - r_{ki} r_{kj})\)</p>
                </div>
                
                <div class="concept-card">
                    <h3>🌀 Angular Momentum</h3>
                    <p>Angular momentum relates to angular velocity through the inertia tensor:</p>
                    <div class="equation-box">
                        \[\mathbf{L} = \mathbf{I} \boldsymbol{\omega}\]
                    </div>
                    <p>In component form: \(L_i = \sum_j I_{ij} \omega_j\)</p>
                </div>
                
                <div class="concept-card">
                    <h3>⚡ Euler's Equations</h3>
                    <p>The equations of motion for a rigid body in its principal axis frame:</p>
                    <div class="equation-box">
                        \[\begin{align}
                        I_1 \dot{\omega}_1 &= (I_2 - I_3)\omega_2 \omega_3 + \tau_1 \\
                        I_2 \dot{\omega}_2 &= (I_3 - I_1)\omega_3 \omega_1 + \tau_2 \\
                        I_3 \dot{\omega}_3 &= (I_1 - I_2)\omega_1 \omega_2 + \tau_3
                        \end{align}\]
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>🎡 Principal Axes</h3>
                    <p>Principal axes are eigenvectors of the inertia tensor where it becomes diagonal:</p>
                    <div class="equation-box">
                        \[\mathbf{I} \mathbf{e}_i = I_i \mathbf{e}_i\]
                    </div>
                    <p>Principal moments: \(I_1 \leq I_2 \leq I_3\)</p>
                </div>
                
                <div class="concept-card">
                    <h3>🌊 Gyroscopic Effect</h3>
                    <p>When a torque is applied perpendicular to the spin axis:</p>
                    <div class="equation-box">
                        \[\boldsymbol{\Omega} = \frac{\boldsymbol{\tau} \times \mathbf{L}}{|\mathbf{L}|^2}\]
                    </div>
                    <p>Precession frequency: \(\Omega = \frac{\tau}{L \sin\theta}\)</p>
                </div>
                
                <div class="concept-card">
                    <h3>⚖️ Kinetic Energy</h3>
                    <p>Rotational kinetic energy in terms of angular velocity:</p>
                    <div class="equation-box">
                        \[T = \frac{1}{2} \boldsymbol{\omega}^T \mathbf{I} \boldsymbol{\omega} = \frac{1}{2} \sum_{i,j} I_{ij} \omega_i \omega_j\]
                    </div>
                    <p>In principal axes: \(T = \frac{1}{2}(I_1\omega_1^2 + I_2\omega_2^2 + I_3\omega_3^2)\)</p>
                </div>
            </div>
        </div>

        <div class="demo-grid">
            <div class="control-panel">
                <h3>🎮 Rigid Body Rotation Controls</h3>
                
                <div>
                    <label>Object Type:</label>
                    <select id="objectType" onchange="updateObjectGeometry()">
                        <option value="rod">Thin Rod</option>
                        <option value="disk">Disk</option>
                        <option value="sphere">Sphere</option>
                        <option value="box">Rectangular Box</option>
                        <option value="ellipsoid">Ellipsoid</option>
                    </select>
                </div>
                
                <div>
                    <label>Initial Angular Velocity ω₁: <span id="omega1Value">2.0</span> rad/s</label>
                    <input type="range" id="omega1" min="0" max="10" value="2" step="0.1" oninput="updateAngularVelocity()">
                </div>
                
                <div>
                    <label>Initial Angular Velocity ω₂: <span id="omega2Value">1.0</span> rad/s</label>
                    <input type="range" id="omega2" min="0" max="10" value="1" step="0.1" oninput="updateAngularVelocity()">
                </div>
                
                <div>
                    <label>Initial Angular Velocity ω₃: <span id="omega3Value">0.5</span> rad/s</label>
                    <input type="range" id="omega3" min="0" max="10" value="0.5" step="0.1" oninput="updateAngularVelocity()">
                </div>
                
                <div>
                    <label>Applied Torque τ: <span id="torqueValue">0.0</span> N⋅m</label>
                    <input type="range" id="torque" min="-5" max="5" value="0" step="0.1" oninput="updateTorque()">
                </div>
                
                <div class="visualization-controls">
                    <button onclick="startSimulation()">▶️ Start</button>
                    <button onclick="pauseSimulation()">⏸️ Pause</button>
                    <button onclick="resetSimulation()">🔄 Reset</button>
                    <button onclick="togglePrincipalAxes()">📐 Principal Axes</button>
                </div>
                
                <div id="inertiaDisplay" class="equation-box">
                    <h4>Moment of Inertia Tensor:</h4>
                    <div id="inertiaMatrix"></div>
                </div>
            </div>
            
            <div class="physics-simulator" id="rigidBodySim">
                <div id="rigidBody" class="rigid-body"></div>
                <div id="angularVelocityVector" class="angular-velocity-vector"></div>
                <div id="torqueVector" class="torque-vector"></div>
                <div id="principalAxis1" class="principal-axis"></div>
                <div id="principalAxis2" class="principal-axis"></div>
                <div id="principalAxis3" class="principal-axis"></div>
                <div id="inertiaEllipsoid" class="inertia-ellipsoid"></div>
            </div>
        </div>

        <div class="tensor-visualization">
            <h3>🎯 Moment of Inertia Tensor Visualization</h3>
            <p>The moment of inertia tensor is a 3×3 symmetric matrix that completely describes the rotational inertia of a rigid body:</p>
            
            <div class="equation-box">
                \[\mathbf{I} = \begin{pmatrix}
                I_{xx} & I_{xy} & I_{xz} \\
                I_{xy} & I_{yy} & I_{yz} \\
                I_{xz} & I_{yz} & I_{zz}
                \end{pmatrix}\]
            </div>
            
            <canvas id="tensorChart" width="400" height="300"></canvas>
            
            <div class="demo-grid">
                <div>
                    <h4>🔍 Diagonal Elements (Moments of Inertia)</h4>
                    <ul>
                        <li><strong>I_xx:</strong> Resistance to rotation about x-axis</li>
                        <li><strong>I_yy:</strong> Resistance to rotation about y-axis</li>
                        <li><strong>I_zz:</strong> Resistance to rotation about z-axis</li>
                    </ul>
                </div>
                
                <div>
                    <h4>🔄 Off-Diagonal Elements (Products of Inertia)</h4>
                    <ul>
                        <li><strong>I_xy, I_xz, I_yz:</strong> Coupling between rotations</li>
                        <li>Zero when axes are principal axes</li>
                        <li>Cause precession and nutation</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="gyroscope-demo">
            <h3>🌊 Gyroscopic Motion Demonstration</h3>
            <p>A gyroscope demonstrates the fascinating behavior of spinning rigid bodies under external torques:</p>
            
            <div class="demo-grid">
                <div class="control-panel">
                    <h4>🎮 Gyroscope Controls</h4>
                    
                    <div>
                        <label>Spin Rate Ω: <span id="spinRateValue">10.0</span> rad/s</label>
                        <input type="range" id="spinRate" min="1" max="50" value="10" step="0.5" oninput="updateGyroscope()">
                    </div>
                    
                    <div>
                        <label>Applied Torque: <span id="gyroTorqueValue">1.0</span> N⋅m</label>
                        <input type="range" id="gyroTorque" min="0" max="5" value="1" step="0.1" oninput="updateGyroscope()">
                    </div>
                    
                    <div>
                        <label>Tilt Angle θ: <span id="tiltAngleValue">30</span>°</label>
                        <input type="range" id="tiltAngle" min="0" max="90" value="30" step="1" oninput="updateGyroscope()">
                    </div>
                    
                    <button onclick="startGyroscope()">🌀 Start Precession</button>
                    <button onclick="stopGyroscope()">⏹️ Stop</button>
                    
                    <div class="equation-box">
                        <h4>Precession Rate:</h4>
                        <div id="precessionRate"></div>
                    </div>
                </div>
                
                <div class="physics-simulator" id="gyroscopeSim">
                    <div id="gyroscopeBody" class="rigid-body" style="border-radius: 50%;"></div>
                    <div id="gyroscopeAxis" class="principal-axis"></div>
                    <div id="precessionVector" class="angular-velocity-vector"></div>
                </div>
            </div>
            
            <div class="equation-box">
                <h4>📐 Gyroscopic Equations:</h4>
                \[\begin{align}
                \text{Angular Momentum: } &\mathbf{L} = I\Omega \hat{\mathbf{k}} \\
                \text{Torque: } &\boldsymbol{\tau} = mg d \sin\theta \hat{\mathbf{j}} \\
                \text{Precession: } &\frac{d\mathbf{L}}{dt} = \boldsymbol{\tau} \\
                \text{Precession Rate: } &\omega_p = \frac{\tau}{L\sin\theta} = \frac{mgd}{I\Omega}
                \end{align}\]
            </div>
        </div>

        <div class="three-column">
            <div class="concept-card">
                <h3>🎯 Parallel Axis Theorem</h3>
                <p>For an object with moment of inertia I_cm about its center of mass:</p>
                <div class="equation-box">
                    \[I = I_{cm} + Md^2\]
                </div>
                <p>Where d is the distance to the new axis.</p>
                
                <div>
                    <label>Distance d: <span id="parallelDistanceValue">1.0</span> m</label>
                    <input type="range" id="parallelDistance" min="0" max="3" value="1" step="0.1" oninput="updateParallelAxis()">
                </div>
                
                <div id="parallelAxisResult" class="equation-box"></div>
            </div>
            
            <div class="concept-card">
                <h3>🌀 Euler Angles</h3>
                <p>Three angles (φ, θ, ψ) that describe the orientation of a rigid body:</p>
                <ul>
                    <li><strong>φ (Precession):</strong> Rotation about fixed z-axis</li>
                    <li><strong>θ (Nutation):</strong> Rotation about line of nodes</li>
                    <li><strong>ψ (Spin):</strong> Rotation about body z-axis</li>
                </ul>
                
                <canvas id="eulerAnglesChart" width="300" height="200"></canvas>
            </div>
            
            <div class="concept-card">
                <h3>⚖️ Stability Analysis</h3>
                <p>Rotation about different principal axes has different stability:</p>
                <ul>
                    <li><strong>Maximum I₃:</strong> Stable rotation</li>
                    <li><strong>Minimum I₁:</strong> Stable rotation</li>
                    <li><strong>Intermediate I₂:</strong> Unstable rotation</li>
                </ul>
                
                <div>
                    <label>Perturbation: <span id="perturbationValue">0.1</span></label>
                    <input type="range" id="perturbation" min="0" max="1" value="0.1" step="0.01" oninput="updateStability()">
                </div>
                
                <button onclick="testStability()">🧪 Test Stability</button>
            </div>
        </div>

        <div class="theory-section">
            <h2>🎓 Applications and Examples</h2>
            
            <div class="concept-grid">
                <div class="concept-card">
                    <h3>🛰️ Spacecraft Attitude Control</h3>
                    <p>Spacecraft use reaction wheels and gyroscopes for orientation control. The spacecraft's inertia tensor determines its response to torques.</p>
                    <div class="equation-box">
                        \[\boldsymbol{\tau}_{external} + \boldsymbol{\tau}_{wheels} = \mathbf{I} \dot{\boldsymbol{\omega}} + \boldsymbol{\omega} \times \mathbf{I} \boldsymbol{\omega}\]
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>🏈 Sports Ball Dynamics</h3>
                    <p>The tumbling motion of footballs, the curve of spinning soccer balls, and the stability of spinning bullets all involve rigid body mechanics.</p>
                    <div class="equation-box">
                        \[\text{Magnus Force: } \mathbf{F}_M = \frac{1}{2}\rho V^2 A C_M (\hat{\boldsymbol{\omega}} \times \hat{\mathbf{v}})\]
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>🏗️ Structural Engineering</h3>
                    <p>Understanding how buildings and bridges respond to wind loads and earthquakes requires analysis of their moment of inertia and rotational dynamics.</p>
                </div>
                
                <div class="concept-card">
                    <h3>🚗 Vehicle Dynamics</h3>
                    <p>Car handling, motorcycle stability, and aircraft control all depend on the moment of inertia tensor and gyroscopic effects.</p>
                </div>
                
                <div class="concept-card">
                    <h3>🔬 Molecular Rotation</h3>
                    <p>Molecular spectroscopy uses rigid body mechanics to understand rotational energy levels in molecules.</p>
                    <div class="equation-box">
                        \[E_J = \frac{\hbar^2}{2I} J(J+1)\]
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>⚙️ Mechanical Systems</h3>
                    <p>Flywheels, turbines, and rotating machinery require careful analysis of rotational inertia and dynamic balance.</p>
                </div>
            </div>
        </div>

        <div class="theory-section">
            <h2>🧮 Common Moment of Inertia Formulas</h2>
            
            <div class="concept-grid">
                <div class="concept-card">
                    <h3>📏 Thin Rod (length L, mass M)</h3>
                    <div class="equation-box">
                        \[\begin{align}
                        I_{center} &= \frac{1}{12}ML^2 \\
                        I_{end} &= \frac{1}{3}ML^2
                        \end{align}\]
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>⭕ Disk (radius R, mass M)</h3>
                    <div class="equation-box">
                        \[\begin{align}
                        I_{center,axis} &= \frac{1}{2}MR^2 \\
                        I_{center,diameter} &= \frac{1}{4}MR^2
                        \end{align}\]
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>🟩 Rectangular Plate (a×b, mass M)</h3>
                    <div class="equation-box">
                        \[\begin{align}
                        I_{x} &= \frac{1}{12}M(b^2) \\
                        I_{y} &= \frac{1}{12}M(a^2) \\
                        I_{z} &= \frac{1}{12}M(a^2 + b^2)
                        \end{align}\]
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>🏀 Solid Sphere (radius R, mass M)</h3>
                    <div class="equation-box">
                        \[I = \frac{2}{5}MR^2\]
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>🥎 Hollow Sphere (radius R, mass M)</h3>
                    <div class="equation-box">
                        \[I = \frac{2}{3}MR^2\]
                    </div>
                </div>
                
                <div class="concept-card">
                    <h3>📦 Rectangular Box (a×b×c, mass M)</h3>
                    <div class="equation-box">
                        \[\begin{align}
                        I_{x} &= \frac{1}{12}M(b^2 + c^2) \\
                        I_{y} &= \frac{1}{12}M(a^2 + c^2) \\
                        I_{z} &= \frac{1}{12}M(a^2 + b^2)
                        \end{align}\]
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                packages: ['base', 'ams', 'color'],
                autoload: {},  // Disable autoloading
                macros: {
                    boldsymbol: ['\\mathbf{#1}', 1],
                    vb: ['\\mathbf{#1}', 1],
                    mb: ['\\mathbf{#1}', 1]
                }
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                ready: () => {
                    console.log('MathJax is loaded and ready.');
                    MathJax.startup.defaultReady();
                    // Initialize everything after MathJax is ready
                    initializeAfterMathJax();
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script>

        // Global variables
        let simulationRunning = false;
        let animationId;
        let time = 0;
        let dt = 0.016; // 60 FPS
        
        // Rigid body properties
        let omega = [2.0, 1.0, 0.5]; // Angular velocity vector
        let inertia = [1.0, 2.0, 3.0]; // Principal moments of inertia
        let torque = [0, 0, 0]; // Applied torque
        let orientation = [0, 0, 0]; // Euler angles
        
        // Gyroscope properties
        let gyroscopeRunning = false;
        let spinRate = 10.0;
        let precessionRate = 0;
        let gyroTilt = 30;
        
        // Object geometries and their inertia properties
        const objectTypes = {
            rod: { inertia: [0.083, 1.0, 1.0], shape: 'rectangle', width: 100, height: 10 },
            disk: { inertia: [0.5, 0.5, 1.0], shape: 'circle', width: 60, height: 60 },
            sphere: { inertia: [0.4, 0.4, 0.4], shape: 'circle', width: 50, height: 50 },
            box: { inertia: [0.167, 0.083, 0.083], shape: 'rectangle', width: 80, height: 40 },
            ellipsoid: { inertia: [0.2, 0.4, 0.6], shape: 'ellipse', width: 70, height: 50 }
        };

        function updateObjectGeometry() {
            const objectType = document.getElementById('objectType').value;
            const props = objectTypes[objectType];
            
            inertia = [...props.inertia];
            
            const rigidBody = document.getElementById('rigidBody');
            rigidBody.style.width = props.width + 'px';
            rigidBody.style.height = props.height + 'px';
            
            if (props.shape === 'circle') {
                rigidBody.style.borderRadius = '50%';
            } else if (props.shape === 'ellipse') {
                rigidBody.style.borderRadius = '50%';
            } else {
                rigidBody.style.borderRadius = '5px';
            }
            
            updateInertiaDisplay();
        }

        function updateAngularVelocity() {
            omega[0] = parseFloat(document.getElementById('omega1').value);
            omega[1] = parseFloat(document.getElementById('omega2').value);
            omega[2] = parseFloat(document.getElementById('omega3').value);
            
            document.getElementById('omega1Value').textContent = omega[0].toFixed(1);
            document.getElementById('omega2Value').textContent = omega[1].toFixed(1);
            document.getElementById('omega3Value').textContent = omega[2].toFixed(1);
        }

        function updateTorque() {
            const torqueValue = parseFloat(document.getElementById('torque').value);
            torque = [torqueValue, 0, 0];
            
            document.getElementById('torqueValue').textContent = torqueValue.toFixed(1);
            
            // Update torque vector visualization
            const torqueVector = document.getElementById('torqueVector');
            const magnitude = Math.abs(torqueValue) * 30;
            torqueVector.style.width = magnitude + 'px';
            torqueVector.style.display = magnitude > 0 ? 'block' : 'none';
        }

        function updateInertiaDisplay() {
            const matrixHtml = `
                \\[\\mathbf{I} = \\begin{pmatrix}
                ${inertia[0].toFixed(2)} & 0 & 0 \\\\
                0 & ${inertia[1].toFixed(2)} & 0 \\\\
                0 & 0 & ${inertia[2].toFixed(2)}
                \\end{pmatrix}\\]
            `;
            
            document.getElementById('inertiaMatrix').innerHTML = matrixHtml;
            
            // Ensure MathJax is loaded before calling typesetPromise
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([document.getElementById('inertiaMatrix')]);
            }
        }

        function startSimulation() {
            simulationRunning = true;
            time = 0;
            animate();
        }

        function pauseSimulation() {
            simulationRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        }

        function resetSimulation() {
            pauseSimulation();
            time = 0;
            omega = [2.0, 1.0, 0.5];
            orientation = [0, 0, 0];
            
            // Reset UI
            document.getElementById('omega1').value = 2.0;
            document.getElementById('omega2').value = 1.0;
            document.getElementById('omega3').value = 0.5;
            updateAngularVelocity();
            
            // Reset visualization
            const rigidBody = document.getElementById('rigidBody');
            rigidBody.style.transform = 'translate(200px, 200px) rotate(0deg)';
        }

        function animate() {
            if (!simulationRunning) return;
            
            // Euler's equations for free rotation (no external torque case)
            if (Math.abs(torque[0]) < 0.01) {
                const domega1 = ((inertia[1] - inertia[2]) * omega[1] * omega[2]) / inertia[0];
                const domega2 = ((inertia[2] - inertia[0]) * omega[2] * omega[0]) / inertia[1];
                const domega3 = ((inertia[0] - inertia[1]) * omega[0] * omega[1]) / inertia[2];
                
                omega[0] += domega1 * dt;
                omega[1] += domega2 * dt;
                omega[2] += domega3 * dt;
            } else {
                // With external torque
                const domega1 = (torque[0] + (inertia[1] - inertia[2]) * omega[1] * omega[2]) / inertia[0];
                const domega2 = ((inertia[2] - inertia[0]) * omega[2] * omega[0]) / inertia[1];
                const domega3 = ((inertia[0] - inertia[1]) * omega[0] * omega[1]) / inertia[2];
                
                omega[0] += domega1 * dt;
                omega[1] += domega2 * dt;
                omega[2] += domega3 * dt;
            }
            
            // Update orientation (simplified)
            orientation[0] += omega[0] * dt;
            orientation[1] += omega[1] * dt;
            orientation[2] += omega[2] * dt;
            
            // Update visualization
            const rigidBody = document.getElementById('rigidBody');
            const centerX = 200;
            const centerY = 200;
            
            rigidBody.style.transform = `translate(${centerX}px, ${centerY}px) 
                rotateX(${orientation[0] * 180 / Math.PI}deg) 
                rotateY(${orientation[1] * 180 / Math.PI}deg) 
                rotateZ(${orientation[2] * 180 / Math.PI}deg)`;
            
            // Update angular velocity vector
            const omegaMagnitude = Math.sqrt(omega[0]**2 + omega[1]**2 + omega[2]**2);
            const omegaVector = document.getElementById('angularVelocityVector');
            omegaVector.style.width = (omegaMagnitude * 30) + 'px';
            omegaVector.style.left = centerX + 'px';
            omegaVector.style.top = centerY + 'px';
            omegaVector.style.transform = `rotate(${Math.atan2(omega[1], omega[0]) * 180 / Math.PI}deg)`;
            
            time += dt;
            animationId = requestAnimationFrame(animate);
        }

        function togglePrincipalAxes() {
            const axes = ['principalAxis1', 'principalAxis2', 'principalAxis3'];
            axes.forEach((axisId, i) => {
                const axis = document.getElementById(axisId);
                const isVisible = axis.style.display !== 'none';
                
                if (!isVisible) {
                    axis.style.display = 'block';
                    axis.style.width = '100px';
                    axis.style.left = '200px';
                    axis.style.top = '200px';
                    axis.style.transform = `rotate(${i * 60}deg)`;
                } else {
                    axis.style.display = 'none';
                }
            });
        }

        // Gyroscope functions
        function updateGyroscope() {
            spinRate = parseFloat(document.getElementById('spinRate').value);
            const gyroTorque = parseFloat(document.getElementById('gyroTorque').value);
            gyroTilt = parseFloat(document.getElementById('tiltAngle').value);
            
            document.getElementById('spinRateValue').textContent = spinRate.toFixed(1);
            document.getElementById('gyroTorqueValue').textContent = gyroTorque.toFixed(1);
            document.getElementById('tiltAngleValue').textContent = gyroTilt;
            
            // Calculate precession rate: ω_p = τ / (L sin θ)
            // Assuming I = 1 for simplicity, L = I * Ω = Ω
            const L = spinRate; // Angular momentum magnitude
            const theta = gyroTilt * Math.PI / 180;
            precessionRate = gyroTorque / (L * Math.sin(theta));
            
            document.getElementById('precessionRate').innerHTML = `
                \\[\\omega_p = \\frac{\\tau}{L\\sin\\theta} = \\frac{${gyroTorque}}{${L.toFixed(1)} \\times \\sin(${gyroTilt}°)} = ${precessionRate.toFixed(3)} \\text{ rad/s}\\]
            `;
            
            // Ensure MathJax is loaded before calling typesetPromise
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([document.getElementById('precessionRate')]);
            }
        }

        function startGyroscope() {
            gyroscopeRunning = true;
            animateGyroscope();
        }

        function stopGyroscope() {
            gyroscopeRunning = false;
        }

        function animateGyroscope() {
            if (!gyroscopeRunning) return;
            
            // Update gyroscope visualization
            const gyroBody = document.getElementById('gyroscopeBody');
            const gyroAxis = document.getElementById('gyroscopeAxis');
            const precessionVector = document.getElementById('precessionVector');
            
            const centerX = 200;
            const centerY = 200;
            
            // Spinning motion
            const spinAngle = (time * spinRate * 180 / Math.PI) % 360;
            gyroBody.style.transform = `translate(${centerX}px, ${centerY}px) 
                rotateY(${gyroTilt}deg) rotateZ(${spinAngle}deg)`;
            
            // Precession motion
            const precessionAngle = (time * precessionRate * 180 / Math.PI) % 360;
            gyroAxis.style.transform = `translate(${centerX}px, ${centerY}px) 
                rotateZ(${precessionAngle}deg) rotateY(${gyroTilt}deg)`;
            
            time += dt;
            
            if (gyroscopeRunning) {
                requestAnimationFrame(animateGyroscope);
            }
        }

        // Parallel axis theorem
        function updateParallelAxis() {
            const distance = parseFloat(document.getElementById('parallelDistance').value);
            document.getElementById('parallelDistanceValue').textContent = distance.toFixed(1);
            
            const mass = 1.0; // Assume unit mass
            const I_cm = 0.5; // Moment of inertia about center of mass
            const I_new = I_cm + mass * distance * distance;
            
            document.getElementById('parallelAxisResult').innerHTML = `
                \\[I = I_{cm} + Md^2 = ${I_cm} + ${mass} \\times ${distance}^2 = ${I_new.toFixed(3)}\\]
            `;
            
            // Ensure MathJax is loaded before calling typesetPromise
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise([document.getElementById('parallelAxisResult')]);
            }
        }

        function updateStability() {
            const perturbation = parseFloat(document.getElementById('perturbation').value);
            document.getElementById('perturbationValue').textContent = perturbation.toFixed(2);
        }

        function testStability() {
            // Simulate stability test for intermediate axis rotation
            alert('Testing stability... Rotation about intermediate axis (I₂) shows unstable behavior due to the intermediate axis theorem!');
        }

        // Initialize visualizations
        function initializeCharts() {
            // Tensor visualization chart
            const tensorCtx = document.getElementById('tensorChart').getContext('2d');
            new Chart(tensorCtx, {
                type: 'bar',
                data: {
                    labels: ['I₁₁', 'I₂₂', 'I₃₃'],
                    datasets: [{
                        label: 'Principal Moments of Inertia',
                        data: inertia,
                        backgroundColor: ['#63b3ed', '#ed8936', '#48bb78'],
                        borderColor: ['#4299e1', '#dd6b20', '#38a169'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: false,
                    plugins: {
                        legend: {
                            labels: { color: 'white' }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: { 
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });

            // Euler angles chart
            const eulerCtx = document.getElementById('eulerAnglesChart').getContext('2d');
            new Chart(eulerCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 100}, (_, i) => i),
                    datasets: [
                        {
                            label: 'φ (Precession)',
                            data: Array.from({length: 100}, (_, i) => Math.sin(i * 0.1) * 30),
                            borderColor: '#63b3ed',
                            fill: false
                        },
                        {
                            label: 'θ (Nutation)', 
                            data: Array.from({length: 100}, (_, i) => Math.cos(i * 0.2) * 20),
                            borderColor: '#ed8936',
                            fill: false
                        },
                        {
                            label: 'ψ (Spin)',
                            data: Array.from({length: 100}, (_, i) => i * 3.6 % 360 - 180),
                            borderColor: '#48bb78',
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: false,
                    plugins: {
                        legend: {
                            labels: { color: 'white', font: { size: 10 } }
                        }
                    },
                    scales: {
                        y: { 
                            ticks: { color: 'white', font: { size: 8 } },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: { 
                            ticks: { color: 'white', font: { size: 8 } },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }

        // Function to initialize everything after MathJax is ready
        function initializeAfterMathJax() {
            updateObjectGeometry();
            updateAngularVelocity();
            updateTorque();
            updateGyroscope();
            updateParallelAxis();
            initializeCharts();
            
            // Ensure MathJax renders everything
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise();
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // If MathJax is already loaded, initialize immediately
            if (window.MathJax && MathJax.typesetPromise) {
                initializeAfterMathJax();
            }
            // Otherwise, wait for MathJax to load via the startup.ready callback
        });
    </script>
</body>
</html>
