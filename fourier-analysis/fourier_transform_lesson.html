<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fourier Transform - Bài Học Tương Tác</title>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script src="../math-simple.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: 2.8em;
            font-weight: 700;
            background: linear-gradient(45deg, #00d4ff, #ff6b6b);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .lesson-nav {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 10px;
        }

        .nav-button {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .nav-button.active {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .lesson-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .lesson-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .theory-box {
            background: rgba(255, 215, 0, 0.1);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #FFD700;
        }

        .content-layout {
            display: grid;
            grid-template-columns: 1fr 450px;
            gap: 25px;
            margin-bottom: 25px;
        }

        .visualization-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #fff;
        }

        .slider-container {
            position: relative;
            margin-bottom: 10px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 212, 255, 0.3);
        }

        .value-display {
            text-align: center;
            font-weight: bold;
            color: #00d4ff;
            margin-top: 5px;
        }

        .canvas-container {
            background: #000;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
        }

        canvas {
            border-radius: 8px;
            display: block;
        }

        .formula-box {
            background: rgba(0, 150, 255, 0.1);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .key-concept {
            background: rgba(255, 100, 100, 0.1);
            border-left: 4px solid #ff6464;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .example-box {
            background: rgba(100, 255, 100, 0.1);
            border-left: 4px solid #64ff64;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .step-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .step-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .step-number {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .interactive-demo {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .demo-title {
            color: #00d4ff;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .component-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .component-item.fundamental {
            border-left-color: #FF6B6B;
        }
        
        .component-item.harmonic {
            border-left-color: #4ECDC4;
        }
        
        .component-info {
            flex-grow: 1;
        }
        
        .component-controls {
            display: flex;
            gap: 8px;
        }
        
        .component-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .play-btn {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
        }
        
        .toggle-btn {
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            color: white;
        }
        
        .toggle-btn.disabled {
            background: #666;
            opacity: 0.5;
        }
        
        .component-btn:hover:not(.disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .chord-note-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 4px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chord-note-item.note1 {
            border-left-color: #FF6B6B;
        }
        
        .chord-note-item.note2 {
            border-left-color: #4ECDC4;
        }
        
        .chord-note-item.note3 {
            border-left-color: #FFD93D;
        }
        
        .note-info {
            flex-grow: 1;
        }
        
        .note-controls {
            display: flex;
            gap: 6px;
        }
        
        .note-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
        }
        
        .note-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* New styles for complex number section */
        .complex-visual {
            background: rgba(138, 43, 226, 0.1);
            border: 2px solid rgba(138, 43, 226, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .euler-demo {
            background: rgba(255, 140, 0, 0.1);
            border: 2px solid rgba(255, 140, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .rotating-vector {
            display: inline-block;
            width: 200px;
            height: 200px;
            border: 2px solid #00d4ff;
            border-radius: 50%;
            position: relative;
            margin: 20px;
            background: radial-gradient(circle, rgba(0,212,255,0.1) 0%, transparent 100%);
        }

        .vector-line {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80px;
            height: 2px;
            background: #ff6b6b;
            transform-origin: left center;
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .phasor-diagram {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .real-imaginary {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .frequency-spectrum {
            background: rgba(34, 193, 195, 0.1);
            border: 2px solid rgba(34, 193, 195, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .interactive-complex {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .complex-plane {
            width: 300px;
            height: 300px;
            border: 2px solid #00d4ff;
            background: rgba(0, 0, 0, 0.7);
            margin: 20px auto;
            position: relative;
        }

        .magnitude-phase {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .magnitude-phase > div {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .content-layout {
                grid-template-columns: 1fr;
            }
            
            .lesson-nav {
                flex-wrap: wrap;
            }
            
            .nav-button {
                margin: 2px;
                padding: 8px 16px;
                font-size: 12px;
            }

            .phasor-diagram {
                grid-template-columns: 1fr;
            }

            .magnitude-phase {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌊 Fourier Transform - Bài Học Tương Tác</h1>
        
        <div class="lesson-nav">
            <button class="nav-button active" onclick="showSection('intro')">Giới Thiệu</button>
            <button class="nav-button" onclick="showSection('history')">Lịch Sử</button>
            <button class="nav-button" onclick="showSection('theory')">Lý Thuyết</button>
            <button class="nav-button" onclick="showSection('complex')">Số Phức</button>
            <button class="nav-button" onclick="showSection('examples')">Ví Dụ Chi Tiết</button>
            <button class="nav-button" onclick="showSection('visualization')">Trực Quan Hóa</button>
            <button class="nav-button" onclick="showSection('applications')">Ứng Dụng</button>
            <button class="nav-button" onclick="showSection('practice')">Thực Hành</button>
        </div>

        <!-- GIỚI THIỆU -->
        <div id="intro" class="lesson-section active">
            <div class="theory-box">
                <h2>🎵 Fourier Transform là gì?</h2>
                <p>Fourier Transform (Biến đổi Fourier) là một trong những công cụ toán học mạnh mẽ nhất, cho phép chúng ta:</p>
                <ul>
                    <li><strong>Phân tích tín hiệu:</strong> Chuyển từ miền thời gian sang miền tần số</li>
                    <li><strong>Hiểu âm thanh:</strong> Tách các nốt nhạc từ một bản nhạc phức tạp</li>
                    <li><strong>Xử lý hình ảnh:</strong> JPEG compression, edge detection</li>
                    <li><strong>Machine Learning:</strong> Feature extraction, convolution</li>
                </ul>
            </div>

            <div class="key-concept">
                <h3>💡 Ý tưởng cốt lõi</h3>
                <p><strong>Mọi tín hiệu phức tạp đều có thể được biểu diễn như tổng của các sóng sin đơn giản!</strong></p>
                <p>Giống như việc phân tích ánh sáng trắng thành các màu cầu vồng qua lăng kính, Fourier Transform phân tích tín hiệu thành các thành phần tần số.</p>
            </div>

            <div class="step-container">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <h4>Tín hiệu đầu vào</h4>
                    <p>Một tín hiệu phức tạp trong miền thời gian f(t)</p>
                </div>
                <div class="step-card">
                    <div class="step-number">2</div>
                    <h4>Biến đổi Fourier</h4>
                    <p>Áp dụng công thức toán học để chuyển đổi</p>
                </div>
                <div class="step-card">
                    <div class="step-number">3</div>
                    <h4>Phổ tần số</h4>
                    <p>Kết quả F(ω) cho biết thành phần tần số nào có trong tín hiệu</p>
                </div>
            </div>
        </div>

        <!-- LỊCH SỬ -->
        <div id="history" class="lesson-section">
            <div class="theory-box">
                <h2>📚 Lịch Sử Phát Triển Fourier Transform</h2>
                
                <h3>🎭 Joseph Fourier (1768-1830)</h3>
                <p><strong>Nhà toán học và vật lý học người Pháp</strong> - Joseph Fourier đã đặt nền móng cho lý thuyết biến đổi Fourier khi nghiên cứu về sự truyền nhiệt.</p>
                
                <div style="background: rgba(0, 212, 255, 0.1); padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #00d4ff;">
                    <h4>🔥 Nghiên cứu về truyền nhiệt (1807)</h4>
                    <p>Fourier phát hiện rằng bất kỳ hàm số nào cũng có thể được biểu diễn dưới dạng tổng của các hàm sin và cos. Ông đã trình bày ý tưởng này trong bài báo "Mémoire sur la propagation de la chaleur dans les corps solides" tại Viện Hàn lâm Khoa học Paris.</p>
                </div>

                <h3>⚡ Phát triển hiện đại</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 8px;">
                        <h4>🔬 Thế kỷ 19-20</h4>
                        <ul>
                            <li><strong>Peter Gustav Lejeune Dirichlet (1829)</strong>: Đưa ra điều kiện Dirichlet cho chuỗi Fourier</li>
                            <li><strong>Georg Riemann (1850s)</strong>: Phát triển lý thuyết tích phân Riemann liên quan đến Fourier</li>
                            <li><strong>Henri Lebesgue (1900s)</strong>: Tổng quát hóa với lý thuyết đo</li>
                        </ul>
                    </div>
                    <div style="background: rgba(255, 99, 132, 0.1); padding: 15px; border-radius: 8px;">
                        <h4>💻 Kỷ nguyên số (1960s)</h4>
                        <ul>
                            <li><strong>James Cooley & John Tukey (1965)</strong>: Phát minh Fast Fourier Transform (FFT)</li>
                            <li><strong>Cách mạng xử lý tín hiệu số</strong></li>
                            <li><strong>Ứng dụng trong máy tính</strong></li>
                        </ul>
                    </div>
                </div>

                <h3>🌍 Tác động lịch sử</h3>
                <div style="background: rgba(76, 175, 80, 0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4>📡 Cuộc cách mạng viễn thông</h4>
                    <p>Fourier Transform đã trở thành nền tảng cho:</p>
                    <ul>
                        <li><strong>Radio và TV</strong>: Điều chế và giải điều chế tín hiệu</li>
                        <li><strong>Kỷ nguyên Internet</strong>: Xử lý tín hiệu số, nén dữ liệu</li>
                        <li><strong>Y học hiện đại</strong>: MRI, CT scan</li>
                        <li><strong>Âm nhạc số</strong>: MP3, audio processing</li>
                    </ul>
                </div>

                <h3>🏆 Di sản khoa học</h3>
                <p>Từ việc nghiên cứu sự truyền nhiệt trong kim loại của Fourier, lý thuyết này đã phát triển thành một trong những công cụ toán học quan trọng nhất, ảnh hưởng đến hầu hết mọi lĩnh vực khoa học và công nghệ hiện đại.</p>
                
                <div style="text-align: center; background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; margin-top: 20px;">
                    <p style="font-style: italic; color: #FFD700;">"Toán học là ngôn ngữ mà Chúa đã viết nên vũ trụ" - Joseph Fourier</p>
                </div>
            </div>
        </div>

        <!-- LÝ THUYẾT -->
        <div id="theory" class="lesson-section">
            <div class="theory-box">
                <h2>📐 Công thức Fourier Transform</h2>
            </div>

            <div class="formula-box">
                <h3>Fourier Transform (Biến đổi thuận)</h3>
                <p>$$F(\omega) = \int_{-\infty}^{\infty} f(t) e^{-i\omega t} dt$$</p>
            </div>

            <div class="formula-box">
                <h3>Inverse Fourier Transform (Biến đổi nghịch)</h3>
                <p>$$f(t) = \frac{1}{2\pi} \int_{-\infty}^{\infty} F(\omega) e^{i\omega t} d\omega$$</p>
            </div>

            <div class="key-concept">
                <h3>🧮 Hiểu công thức</h3>
                <ul>
                    <li><strong>f(t):</strong> Tín hiệu gốc trong miền thời gian</li>
                    <li><strong>F(ω):</strong> Phổ tần số (thường là số phức)</li>
                    <li><strong>ω:</strong> Tần số góc (rad/s)</li>
                    <li><strong>e^(-iωt):</strong> Hàm mũ phức = cos(ωt) - i×sin(ωt)</li>
                </ul>
            </div>

            <div class="example-box">
                <h3>🎼 Ví dụ đơn giản</h3>
                <p><strong>Tín hiệu:</strong> f(t) = cos(2πf₀t)</p>
                <p><strong>Fourier Transform:</strong> F(ω) = π[δ(ω - 2πf₀) + δ(ω + 2πf₀)]</p>
                <p><strong>Ý nghĩa:</strong> Sóng cos thuần túy chỉ có hai tần số: +f₀ và -f₀</p>
            </div>

            <div class="theory-box">
                <h3>📊 Tính chất quan trọng</h3>
                <ul>
                    <li><strong>Tuyến tính:</strong> FT[af(t) + bg(t)] = aF(ω) + bG(ω)</li>
                    <li><strong>Dời thời gian:</strong> FT[f(t-t₀)] = F(ω)e^(-iωt₀)</li>
                    <li><strong>Modulation:</strong> FT[f(t)e^(iω₀t)] = F(ω-ω₀)</li>
                    <li><strong>Convolution:</strong> FT[f*g] = F(ω)×G(ω)</li>
                </ul>
            </div>
        </div>

        <!-- SỐ PHỨC VÀ FOURIER TRANSFORM -->
        <div id="complex" class="lesson-section">
            <div class="theory-box">
                <h2>🔢 Số Phức trong Fourier Transform</h2>
                <p>Số phức là chìa khóa để hiểu sâu về Fourier Transform. Hãy khám phá tại sao!</p>
            </div>

            <div class="complex-visual">
                <h3>🌟 Công thức Euler - Cầu nối thần kỳ</h3>
                <div class="euler-demo">
                    <h4>$$e^{i\theta} = \cos(\theta) + i\sin(\theta)$$</h4>
                    <p><strong>Ý nghĩa:</strong> Số phức trên đường tròn đơn vị!</p>
                    
                    <div class="rotating-vector">
                        <div class="vector-line"></div>
                        <div style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); color: #00d4ff; font-size: 12px;">Im</div>
                        <div style="position: absolute; top: 50%; right: -15px; transform: translateY(-50%); color: #00d4ff; font-size: 12px;">Re</div>
                        <div style="position: absolute; bottom: 50%; left: 50%; color: #ff6b6b; font-size: 12px;">e^(iωt)</div>
                    </div>
                    
                    <p style="margin-top: 20px;">Vector xoay với tốc độ ω rad/s</p>
                </div>
            </div>

            <div class="key-concept">
                <h3>🧮 Tại sao cần số phức?</h3>
                <div class="phasor-diagram">
                    <div class="real-imaginary">
                        <h4>🔵 Phần Thực (Real)</h4>
                        <p>$$\text{Re}[F(\omega)] = \int_{-\infty}^{\infty} f(t) \cos(\omega t) dt$$</p>
                        <p><strong>Thể hiện:</strong> Thành phần cosine của tín hiệu tại tần số ω</p>
                    </div>
                    <div class="real-imaginary">
                        <h4>🔴 Phần Ảo (Imaginary)</h4>
                        <p>$$\text{Im}[F(\omega)] = -\int_{-\infty}^{\infty} f(t) \sin(\omega t) dt$$</p>
                        <p><strong>Thể hiện:</strong> Thành phần sine của tín hiệu tại tần số ω</p>
                    </div>
                </div>
            </div>

            <div class="frequency-spectrum">
                <h3>📊 Biểu diễn số phức trong phổ tần số</h3>
                <div class="magnitude-phase">
                    <div>
                        <h4>🎵 Độ lớn (Magnitude)</h4>
                        <p>$$|F(\omega)| = \sqrt{[\text{Re}[F(\omega)]]^2 + [\text{Im}[F(\omega)]]^2}$$</p>
                        <p><strong>Ý nghĩa:</strong> "Âm lượng" của tần số ω trong tín hiệu</p>
                    </div>
                    <div>
                        <h4>🎭 Pha (Phase)</h4>
                        <p>$$\phi(\omega) = \arctan\left(\frac{\text{Im}[F(\omega)]}{\text{Re}[F(\omega)]}\right)$$</p>
                        <p><strong>Ý nghĩa:</strong> "Thời điểm xuất hiện" của tần số ω</p>
                    </div>
                </div>
            </div>

            <div class="interactive-complex">
                <h3>🎮 Tương tác với số phức</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4>Điều khiển số phức:</h4>
                        <div class="control-group">
                            <label>Độ lớn (r): <span id="magnitudeValue">1.0</span></label>
                            <input type="range" id="magnitudeSlider" min="0.1" max="2" step="0.1" value="1" oninput="updateComplexDemo()">
                        </div>
                        <div class="control-group">
                            <label>Pha (θ): <span id="phaseValue">0°</span></label>
                            <input type="range" id="phaseSlider" min="0" max="360" step="5" value="0" oninput="updateComplexDemo()">
                        </div>
                        <div class="control-group">
                            <label>Tần số (f): <span id="freqValue">1 Hz</span></label>
                            <input type="range" id="freqSlider" min="0.1" max="3" step="0.1" value="1" oninput="updateComplexDemo()">
                        </div>
                    </div>
                    <div>
                        <div class="complex-plane" id="complexPlane">
                            <canvas id="complexCanvas" width="296" height="296"></canvas>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <div>Số phức: <span id="complexNumber">1 + 0i</span></div>
                            <div>Dạng Euler: <span id="eulerForm">1·e^(i·0°)</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="example-box">
                <h3>🎼 Ví dụ thực tế: Phân tích hợp âm</h3>
                <p><strong>Tín hiệu:</strong> f(t) = cos(2πt) + 0.5·cos(4πt) + 0.25·cos(6πt)</p>
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <p><strong>Fourier Transform cho ta:</strong></p>
                    <ul>
                        <li>Tần số 1 Hz: Magnitude = 1, Phase = 0°</li>
                        <li>Tần số 2 Hz: Magnitude = 0.5, Phase = 0°</li>
                        <li>Tần số 3 Hz: Magnitude = 0.25, Phase = 0°</li>
                    </ul>
                </div>
                <p><strong>Kết luận:</strong> Có thể tách riêng từng "nốt nhạc" từ hợp âm phức tạp!</p>
            </div>

            <div class="key-concept">
                <h3>💡 Tại sao cần tần số âm?</h3>
                <p>Trong toán học, <strong>tần số âm</strong> không có nghĩa vật lý trực tiếp, nhưng:</p>
                <ul>
                    <li><strong>Đối xứng toán học:</strong> cos(ωt) có cả +ω và -ω</li>
                    <li><strong>Xử lý tín hiệu phức:</strong> Tách được tín hiệu xoay thuận/nghịch</li>
                    <li><strong>Convolution theorem:</strong> Giúp tính toán nhanh hơn</li>
                </ul>
            </div>
        </div>

        <!-- VÍ DỤ CHI TIẾT -->
        <div id="examples" class="lesson-section">
            <div class="theory-box">
                <h2>📝 Ví Dụ Chi Tiết với Số Phức</h2>
                <p>Hãy cùng tính toán từng bước để hiểu rõ cách Fourier Transform hoạt động!</p>
            </div>

            <div class="example-box">
                <h3>🔍 Ví dụ 1: Tín hiệu Cosine đơn giản</h3>
                <p><strong>Cho:</strong> f(t) = cos(2πf₀t) với f₀ = 5 Hz</p>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>Bước 1: Viết lại bằng công thức Euler</h4>
                    <p>$$\cos(2\pi f_0 t) = \frac{e^{i2\pi f_0 t} + e^{-i2\pi f_0 t}}{2}$$</p>
                    
                    <h4>Bước 2: Áp dụng Fourier Transform</h4>
                    <p>$$F(\omega) = \int_{-\infty}^{\infty} \cos(2\pi f_0 t) e^{-i\omega t} dt$$</p>
                    
                    <h4>Bước 3: Kết quả</h4>
                    <p>$$F(\omega) = \pi[\delta(\omega - 2\pi f_0) + \delta(\omega + 2\pi f_0)]$$</p>
                    
                    <h4>Giải thích:</h4>
                    <ul>
                        <li>Hai "gai" tại ω = ±2π×5 = ±31.4 rad/s</li>
                        <li>Mỗi gai có độ cao π (magnitude)</li>
                        <li>Pha = 0° (vì cosine bắt đầu từ giá trị max)</li>
                    </ul>
                </div>
            </div>

            <div class="example-box">
                <h3>🔍 Ví dụ 2: Tín hiệu Sine với pha khác 0</h3>
                <p><strong>Cho:</strong> f(t) = sin(2πf₀t + φ) với f₀ = 3 Hz, φ = π/4</p>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>Bước 1: Viết lại bằng Euler</h4>
                    <p>$$\sin(2\pi f_0 t + \phi) = \frac{e^{i(2\pi f_0 t + \phi)} - e^{-i(2\pi f_0 t + \phi)}}{2i}$$</p>
                    
                    <h4>Bước 2: Tách pha</h4>
                    <p>$$= \frac{e^{i\phi}e^{i2\pi f_0 t} - e^{-i\phi}e^{-i2\pi f_0 t}}{2i}$$</p>
                    
                    <h4>Bước 3: Fourier Transform</h4>
                    <p>$$F(\omega) = \frac{\pi e^{i\phi}}{i}\delta(\omega - 2\pi f_0) - \frac{\pi e^{-i\phi}}{i}\delta(\omega + 2\pi f_0)$$</p>
                    
                    <h4>Giải thích:</h4>
                    <ul>
                        <li>Hai gai tại ω = ±2π×3 = ±18.85 rad/s</li>
                        <li>Magnitude: |F(ω)| = π tại cả hai tần số</li>
                        <li>Phase: +π/4 tại +18.85, -π/4 tại -18.85</li>
                        <li>Dịch pha φ = π/4 = 45° thể hiện tín hiệu bắt đầu sớm hơn</li>
                    </ul>
                </div>
            </div>

            <div class="example-box">
                <h3>🔍 Ví dụ 3: Xung Gaussian</h3>
                <p><strong>Cho:</strong> f(t) = e^(-t²/2σ²) (Gaussian pulse)</p>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>Tính chất đặc biệt:</h4>
                    <p>$$F(\omega) = \sigma\sqrt{2\pi} \cdot e^{-\sigma^2\omega^2/2}$$</p>
                    
                    <h4>Ý nghĩa quan trọng:</h4>
                    <ul>
                        <li><strong>Gaussian → Gaussian:</strong> Fourier Transform của Gaussian vẫn là Gaussian!</li>
                        <li><strong>Uncertainty Principle:</strong> σ nhỏ (xung hẹp) → phổ tần số rộng</li>
                        <li><strong>Ứng dụng:</strong> Window function trong xử lý tín hiệu</li>
                    </ul>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <canvas id="gaussianDemo" width="400" height="200" style="border: 1px solid #00d4ff; border-radius: 5px;"></canvas>
                        <div style="margin-top: 10px;">
                            <label>σ (độ rộng): <span id="sigmaValue">1.0</span></label><br>
                            <input type="range" id="sigmaSlider" min="0.5" max="3" step="0.1" value="1" oninput="updateGaussianDemo()">
                        </div>
                    </div>
                </div>
            </div>

            <div class="example-box">
                <h3>🔍 Ví dụ 4: Sóng vuông - Series Fourier</h3>
                <p><strong>Cho:</strong> Sóng vuông với chu kỳ T</p>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>Fourier Series:</h4>
                    <p>$$f(t) = \frac{4}{\pi}\sum_{n=1,3,5,...}^{\infty} \frac{\sin(2\pi nf_0 t)}{n}$$</p>
                    
                    <h4>Phổ tần số:</h4>
                    <ul>
                        <li><strong>Tần số cơ bản:</strong> f₀ = 1/T</li>
                        <li><strong>Harmonic lẻ:</strong> 3f₀, 5f₀, 7f₀, ...</li>
                        <li><strong>Amplitude giảm:</strong> 1/n (1, 1/3, 1/5, 1/7, ...)</li>
                        <li><strong>Không có harmonic chẵn!</strong></li>
                    </ul>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <canvas id="squareWaveDemo" width="400" height="200" style="border: 1px solid #00d4ff; border-radius: 5px;"></canvas>
                        <div style="margin-top: 10px;">
                            <label>Số harmonics: <span id="harmonicsValue">5</span></label><br>
                            <input type="range" id="harmonicsSlider" min="1" max="15" step="2" value="5" oninput="updateSquareWaveDemo()">
                        </div>
                    </div>
                </div>
            </div>

            <div class="key-concept">
                <h3>🎯 Kết luận từ các ví dụ</h3>
                <ul>
                    <li><strong>Tín hiệu đơn giản:</strong> Phổ tần số tập trung (ít gai)</li>
                    <li><strong>Tín hiệu phức tạp:</strong> Phổ tần số rộng (nhiều harmonic)</li>
                    <li><strong>Tín hiệu không liên tục:</strong> Phổ tần số vô hạn</li>
                    <li><strong>Pha quan trọng:</strong> Quyết định hình dạng tín hiệu</li>
                    <li><strong>Số phức cần thiết:</strong> Lưu trữ cả magnitude và phase</li>
                </ul>
            </div>
        </div>

        <!-- TRỰC QUAN HÓA -->
        <div id="visualization" class="lesson-section">
            <div class="theory-box">
                <h2>👁️ Trực Quan Hóa Fourier Transform</h2>
                <p>Thực nghiệm với các tín hiệu khác nhau và quan sát phổ tần số của chúng!</p>
            </div>

            <div class="content-layout">
                <div class="visualization-area">
                    <div class="canvas-container">
                        <canvas id="timeCanvas" width="400" height="200"></canvas>
                        <div style="text-align: center; color: #00d4ff; font-weight: bold;">Miền Thời Gian f(t)</div>
                    </div>
                    
                    <div class="canvas-container">
                        <canvas id="freqCanvas" width="400" height="200"></canvas>
                        <div style="text-align: center; color: #ff6b6b; font-weight: bold;">Miền Tần Số |F(ω)|</div>
                    </div>
                </div>

                <div class="controls-panel">
                    <div class="control-group">
                        <label>Loại tín hiệu:</label>
                        <select id="signalType" onchange="updateVisualization()" style="width: 100%; padding: 8px; border-radius: 5px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                            <option value="sine">Sóng Sin</option>
                            <option value="cosine">Sóng Cosine</option>
                            <option value="square">Sóng Vuông</option>
                            <option value="sawtooth">Sóng Răng Cưa</option>
                            <option value="triangle">Sóng Tam Giác</option>
                            <option value="gaussian">Gaussian Pulse</option>
                            <option value="compound">Tín hiệu Hỗn Hợp</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label>Tần số chính (Hz):</label>
                        <div class="slider-container">
                            <input type="range" id="frequency" min="0.5" max="10" step="0.1" value="2" oninput="updateVisualization()">
                            <div class="value-display" id="freqValue">2.0 Hz</div>
                        </div>
                        <button id="playFreqBtn" onclick="playSingleTone()" style="width: 100%; padding: 8px; background: linear-gradient(45deg, #ff6b6b, #ff8e53); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 8px; font-size: 14px;">
                            🔊 Play Frequency Sound
                        </button>
                    </div>

                    <div class="control-group">
                        <label>Biên độ:</label>
                        <div class="slider-container">
                            <input type="range" id="amplitude" min="0.1" max="2" step="0.1" value="1" oninput="updateVisualization()">
                            <div class="value-display" id="ampValue">1.0</div>
                        </div>
                    </div>

                    <div class="control-group" id="phase-control">
                        <label>Pha (radians):</label>
                        <div class="slider-container">
                            <input type="range" id="phase" min="0" max="6.28" step="0.1" value="0" oninput="updateVisualization()">
                            <div class="value-display" id="phaseValue">0.0 rad</div>
                        </div>
                    </div>

                    <div class="control-group" id="harmonics-control" style="display: none;">
                        <label>Số harmonics:</label>
                        <div class="slider-container">
                            <input type="range" id="harmonics" min="1" max="10" step="1" value="3" oninput="updateVisualization()">
                            <div class="value-display" id="harmonicsValue">3</div>
                        </div>
                    </div>

                    <div class="control-group" id="compound-controls" style="display: none;">
                        <label>Tần số thứ 2 (Hz):</label>
                        <div class="slider-container">
                            <input type="range" id="freq2" min="0.5" max="10" step="0.1" value="5" oninput="updateVisualization()">
                            <div class="value-display" id="freq2Value">5.0 Hz</div>
                        </div>
                        <label>Biên độ thứ 2:</label>
                        <div class="slider-container">
                            <input type="range" id="amp2" min="0.1" max="1" step="0.1" value="0.5" oninput="updateVisualization()">
                            <div class="value-display" id="amp2Value">0.5</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="interactive-demo">
                <div class="demo-title">🎚️ Thử nghiệm tương tác</div>
                <div style="background: rgba(255, 193, 7, 0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #FFC107;">
                    <strong>🔊 Audio Playback:</strong> Click the sound buttons to hear the actual frequencies! 
                    (Note: Some browsers require user interaction before playing audio)
                </div>
                <p>• <strong>Sóng Sin/Cosine:</strong> Chỉ có 1 tần số duy nhất trong phổ</p>
                <p>• <strong>Sóng Vuông:</strong> Có nhiều harmonics lẻ (1f, 3f, 5f, ...)</p>
                <p>• <strong>Sóng Răng Cưa:</strong> Có tất cả harmonics (1f, 2f, 3f, ...)</p>
                <p>• <strong>Gaussian Pulse:</strong> Phổ tần số cũng là Gaussian</p>
                <p>• <strong>Tín hiệu Hỗn Hợp:</strong> Tổng của nhiều tần số</p>
            </div>

            <!-- COMPONENT BREAKDOWN SECTION -->
            <div id="component-analysis" style="margin-top: 40px;">
                <div class="theory-box">
                    <h2>🎼 Component Analysis - View & Hear Each Harmonic</h2>
                    <p>Explore individual frequency components that make up complex waveforms!</p>
                </div>

                <div class="content-layout">
                    <div class="visualization-area">
                        <div class="canvas-container">
                            <canvas id="componentsCanvas" width="400" height="300"></canvas>
                            <div style="text-align: center; color: #00d4ff; font-weight: bold;">Individual Components</div>
                        </div>
                        
                        <div class="canvas-container">
                            <canvas id="compositeCanvas" width="400" height="200"></canvas>
                            <div style="text-align: center; color: #ff6b6b; font-weight: bold;">Composite Signal</div>
                        </div>
                    </div>

                    <div class="controls-panel">
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 style="margin-top: 0; color: #FFD700;">🎯 Component Controls</h3>
                            
                            <div style="margin-bottom: 15px;">
                                <button onclick="playAllComponents()" style="width: 100%; padding: 12px; background: linear-gradient(45deg, #4CAF50, #45a049); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 10px;">
                                    🎵 Play All Components Sequentially
                                </button>
                                <button onclick="playCompositeSound()" style="width: 100%; padding: 12px; background: linear-gradient(45deg, #9C27B0, #7B1FA2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                    🎼 Play Composite Sound
                                </button>
                            </div>

                            <div class="control-group">
                                <label>Animation Speed:</label>
                                <div class="slider-container">
                                    <input type="range" id="animationSpeed" min="0.5" max="3" step="0.1" value="1" oninput="updateAnimationSpeed()">
                                    <div class="value-display" id="animSpeedValue">1.0x</div>
                                </div>
                            </div>

                            <div class="control-group">
                                <label>Show Components:</label>
                                <div style="margin-top: 10px;">
                                    <label style="display: inline-block; margin-right: 15px;">
                                        <input type="checkbox" id="showFundamental" checked onchange="updateComponentsDisplay()"> Fundamental
                                    </label>
                                    <label style="display: inline-block; margin-right: 15px;">
                                        <input type="checkbox" id="showHarmonics" checked onchange="updateComponentsDisplay()"> Harmonics
                                    </label>
                                    <label style="display: inline-block;">
                                        <input type="checkbox" id="showSum" checked onchange="updateComponentsDisplay()"> Sum
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic Component List -->
                        <div id="componentsList" style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px;">
                            <h3 style="margin-top: 0; color: #FFD700;">🎼 Active Components</h3>
                            <div id="componentsContainer">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ỨNG DỤNG -->
        <div id="applications" class="lesson-section">
            <div class="theory-box">
                <h2>🚀 Ứng Dụng Thực Tế</h2>
            </div>

            <div class="step-container">
                <div class="step-card">
                    <h3>🎵 Âm Thanh & Âm Nhạc</h3>
                    <ul>
                        <li><strong>MP3/AAC Compression:</strong> Loại bỏ tần số không cần thiết</li>
                        <li><strong>Equalizer:</strong> Điều chỉnh từng dải tần</li>
                        <li><strong>Auto-Tune:</strong> Sửa cao độ giọng hát</li>
                        <li><strong>Noise Cancellation:</strong> Loại bỏ tiếng ồn</li>
                    </ul>
                </div>

                <div class="step-card">
                    <h3>📷 Xử Lý Hình Ảnh</h3>
                    <ul>
                        <li><strong>JPEG Compression:</strong> DCT (Discrete Cosine Transform)</li>
                        <li><strong>Edge Detection:</strong> High-pass filtering</li>
                        <li><strong>Blur/Sharpen:</strong> Low-pass/High-pass filters</li>
                        <li><strong>Pattern Recognition:</strong> Template matching</li>
                    </ul>
                </div>

                <div class="step-card">
                    <h3>📡 Truyền Thông</h3>
                    <ul>
                        <li><strong>Radio/TV:</strong> Modulation/Demodulation</li>
                        <li><strong>WiFi/4G/5G:</strong> OFDM (Orthogonal Frequency Division)</li>
                        <li><strong>Radar:</strong> Object detection and ranging</li>
                        <li><strong>Sonar:</strong> Underwater navigation</li>
                    </ul>
                </div>

                <div class="step-card">
                    <h3>🤖 Machine Learning</h3>
                    <ul>
                        <li><strong>CNN Filters:</strong> Tương tự Fourier filters</li>
                        <li><strong>Speech Recognition:</strong> MFCC features</li>
                        <li><strong>Time Series:</strong> Frequency domain features</li>
                        <li><strong>Signal Processing:</strong> Feature extraction</li>
                    </ul>
                </div>

                <div class="step-card">
                    <h3>🏥 Y Học</h3>
                    <ul>
                        <li><strong>MRI:</strong> Magnetic Resonance Imaging</li>
                        <li><strong>EEG/ECG:</strong> Brain/Heart signal analysis</li>
                        <li><strong>Ultrasound:</strong> Medical imaging</li>
                        <li><strong>X-ray CT:</strong> Computer Tomography</li>
                    </ul>
                </div>

                <div class="step-card">
                    <h3>🔬 Khoa Học</h3>
                    <ul>
                        <li><strong>Spectroscopy:</strong> Chemical analysis</li>
                        <li><strong>Astronomy:</strong> Signal analysis from space</li>
                        <li><strong>Seismology:</strong> Earthquake analysis</li>
                        <li><strong>Quantum Physics:</strong> Wave function analysis</li>
                    </ul>
                </div>
            </div>

            <div class="example-box">
                <h3>🎤 Ví dụ: Giọng nói con người</h3>
                <p>Khi bạn nói "Hello", Fourier Transform giúp:</p>
                <ul>
                    <li><strong>Formants:</strong> Xác định các tần số đặc trưng của nguyên âm</li>
                    <li><strong>Pitch:</strong> Phát hiện cao độ giọng nói</li>
                    <li><strong>Phonemes:</strong> Phân biệt các âm tố</li>
                    <li><strong>Compression:</strong> Nén dữ liệu âm thanh hiệu quả</li>
                </ul>
            </div>
        </div>

        <!-- THỰC HÀNH -->
        <div id="practice" class="lesson-section">
            <div class="theory-box">
                <h2>🎯 Bài Tập Thực Hành</h2>
            </div>

            <div class="interactive-demo">
                <div class="demo-title">🧪 Thí nghiệm 1: Phân tích tín hiệu âm nhạc</div>
                
                <div class="content-layout">
                    <div class="visualization-area">
                        <div class="canvas-container">
                            <canvas id="musicCanvas" width="400" height="200"></canvas>
                            <div style="text-align: center; color: #00d4ff; font-weight: bold;">Tín hiệu âm nhạc</div>
                        </div>
                        
                        <div class="canvas-container">
                            <canvas id="musicSpectrumCanvas" width="400" height="200"></canvas>
                            <div style="text-align: center; color: #ff6b6b; font-weight: bold;">Phổ âm nhạc</div>
                        </div>
                    </div>

                    <div class="controls-panel">
                        <div class="control-group">
                            <label>Chọn hợp âm:</label>
                            <select id="chordType" onchange="updateMusicVisualization()" style="width: 100%; padding: 8px; border-radius: 5px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                                <option value="C">Hợp âm C (Do-Mi-Sol)</option>
                                <option value="Am">Hợp âm Am (La-Do-Mi)</option>
                                <option value="F">Hợp âm F (Fa-La-Do)</option>
                                <option value="G">Hợp âm G (Sol-Si-Re)</option>
                                <option value="Dm">Hợp âm Dm (Re-Fa-La)</option>
                            </select>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                            <button onclick="playChord()" style="padding: 12px; background: linear-gradient(45deg, #00d4ff, #0099cc); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                🎵 Play Full Chord
                            </button>
                            <button onclick="playChordComponents()" style="padding: 12px; background: linear-gradient(45deg, #4CAF50, #45a049); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                � Play Components
                            </button>
                        </div>

                        <div style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <strong>Chord Analysis:</strong>
                            <p id="chordAnalysis">Chọn hợp âm để xem phân tích!</p>
                        </div>
                    </div>
                </div>

                <!-- DETAILED CHORD COMPONENT ANALYSIS -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #FFD700; margin-bottom: 20px;">🎹 Individual Note Components</h3>
                    
                    <div class="content-layout">
                        <div class="visualization-area">
                            <div class="canvas-container">
                                <canvas id="chordComponentsCanvas" width="400" height="300"></canvas>
                                <div style="text-align: center; color: #00d4ff; font-weight: bold;">Individual Notes Waveforms</div>
                            </div>
                            
                            <div class="canvas-container">
                                <canvas id="chordCompositeCanvas" width="400" height="200"></canvas>
                                <div style="text-align: center; color: #ff6b6b; font-weight: bold;">Combined Chord Signal</div>
                            </div>
                        </div>

                        <div class="controls-panel">
                            <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px;">
                                <h4 style="margin-top: 0; color: #FFD700;">🎵 Chord Notes</h4>
                                <div id="chordNotesContainer">
                                    <!-- Will be populated dynamically -->
                                </div>
                                
                                <div style="margin-top: 20px;">
                                    <h4 style="color: #FFD700;">🎚️ Controls</h4>
                                    <div class="control-group">
                                        <label>Note Duration (seconds):</label>
                                        <div class="slider-container">
                                            <input type="range" id="noteDuration" min="0.5" max="3" step="0.1" value="1.5" oninput="updateNoteDuration()">
                                            <div class="value-display" id="noteDurationValue">1.5s</div>
                                        </div>
                                    </div>
                                    
                                    <div class="control-group">
                                        <label>Volume:</label>
                                        <div class="slider-container">
                                            <input type="range" id="chordVolume" min="0.1" max="0.3" step="0.01" value="0.15" oninput="updateChordVolume()">
                                            <div class="value-display" id="chordVolumeValue">0.15</div>
                                        </div>
                                    </div>

                                    <div style="margin-top: 15px;">
                                        <button onclick="playAllNotesSequential()" style="width: 100%; padding: 10px; background: linear-gradient(45deg, #9C27B0, #7B1FA2); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-bottom: 8px;">
                                            🎼 Play Notes Sequentially
                                        </button>
                                        <button onclick="playArpeggio()" style="width: 100%; padding: 10px; background: linear-gradient(45deg, #FF9800, #F57C00); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                            🎹 Play Arpeggio
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="interactive-demo">
                <div class="demo-title">🔍 Thí nghiệm 2: Lọc tần số</div>
                
                <div class="content-layout">
                    <div class="visualization-area">
                        <div class="canvas-container">
                            <canvas id="noisyCanvas" width="400" height="150"></canvas>
                            <div style="text-align: center; color: #00d4ff; font-weight: bold;">Tín hiệu có nhiễu</div>
                        </div>
                        
                        <div class="canvas-container">
                            <canvas id="filteredCanvas" width="400" height="150"></canvas>
                            <div style="text-align: center; color: #64ff64; font-weight: bold;">Tín hiệu đã lọc</div>
                        </div>
                    </div>

                    <div class="controls-panel">
                        <div class="control-group">
                            <label>Loại bộ lọc:</label>
                            <select id="filterType" onchange="updateFilter()" style="width: 100%; padding: 8px; border-radius: 5px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                                <option value="lowpass">Low-pass (Loại bỏ tần số cao)</option>
                                <option value="highpass">High-pass (Loại bỏ tần số thấp)</option>
                                <option value="bandpass">Band-pass (Chỉ giữ một dải tần)</option>
                                <option value="notch">Notch (Loại bỏ một tần số cụ thể)</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label>Tần số cắt (Hz):</label>
                            <div class="slider-container">
                                <input type="range" id="cutoffFreq" min="1" max="20" step="0.5" value="5" oninput="updateFilter()">
                                <div class="value-display" id="cutoffValue">5.0 Hz</div>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>Mức nhiễu:</label>
                            <div class="slider-container">
                                <input type="range" id="noiseLevel" min="0" max="1" step="0.1" value="0.3" oninput="updateFilter()">
                                <div class="value-display" id="noiseValue">0.3</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="key-concept">
                <h3>🎓 Bài tập tự làm</h3>
                <ol>
                    <li><strong>Tín hiệu Composite:</strong> Tạo tín hiệu gồm 3 tần số khác nhau và phân tích phổ</li>
                    <li><strong>Window Functions:</strong> So sánh Rectangular, Hanning, và Blackman windows</li>
                    <li><strong>Sampling Rate:</strong> Quan sát aliasing khi sampling rate quá thấp</li>
                    <li><strong>Real-world Data:</strong> Phân tích tín hiệu từ microphone hoặc accelerometer</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.lesson-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // Visualization variables
        let animationId;
        let timeData = [];
        let freqData = [];

        // Initialize canvases
        function initCanvases() {
            updateVisualization();
            updateMusicVisualization();
            updateFilter();
            
            // Initialize chord notes display
            updateChordNotesDisplay();
        }

        // Main visualization update
        function updateVisualization() {
            const signalType = document.getElementById('signalType').value;
            const frequency = parseFloat(document.getElementById('frequency').value);
            const amplitude = parseFloat(document.getElementById('amplitude').value);
            const phase = parseFloat(document.getElementById('phase').value);
            
            // Update display values
            document.getElementById('freqValue').textContent = frequency.toFixed(1) + ' Hz';
            document.getElementById('ampValue').textContent = amplitude.toFixed(1);
            document.getElementById('phaseValue').textContent = phase.toFixed(1) + ' rad';

            // Update play button text based on waveform
            updatePlayButtonText(signalType);

            // Show/hide controls based on signal type
            const harmonicsControl = document.getElementById('harmonics-control');
            const compoundControls = document.getElementById('compound-controls');
            
            if (signalType === 'square' || signalType === 'sawtooth' || signalType === 'triangle') {
                harmonicsControl.style.display = 'block';
                compoundControls.style.display = 'none';
                const harmonics = parseInt(document.getElementById('harmonics').value);
                document.getElementById('harmonicsValue').textContent = harmonics;
            } else if (signalType === 'compound') {
                harmonicsControl.style.display = 'none';
                compoundControls.style.display = 'block';
                const freq2 = parseFloat(document.getElementById('freq2').value);
                const amp2 = parseFloat(document.getElementById('amp2').value);
                document.getElementById('freq2Value').textContent = freq2.toFixed(1) + ' Hz';
                document.getElementById('amp2Value').textContent = amp2.toFixed(1);
            } else {
                harmonicsControl.style.display = 'none';
                compoundControls.style.display = 'none';
            }

            drawSignal();
            
            // Update component analysis
            initializeComponents();
        }

        function drawSignal() {
            const timeCanvas = document.getElementById('timeCanvas');
            const freqCanvas = document.getElementById('freqCanvas');
            
            if (!timeCanvas || !freqCanvas) return;
            
            const timeCtx = timeCanvas.getContext('2d');
            const freqCtx = freqCanvas.getContext('2d');
            
            const width = timeCanvas.width;
            const height = timeCanvas.height;
            
            // Clear canvases
            timeCtx.clearRect(0, 0, width, height);
            freqCtx.clearRect(0, 0, width, height);
            
            // Generate time domain data
            const numPoints = 1000;
            const duration = 2; // 2 seconds
            timeData = [];
            
            const signalType = document.getElementById('signalType').value;
            const frequency = parseFloat(document.getElementById('frequency').value);
            const amplitude = parseFloat(document.getElementById('amplitude').value);
            const phase = parseFloat(document.getElementById('phase').value);
            
            for (let i = 0; i < numPoints; i++) {
                const t = (i / numPoints) * duration;
                let y = 0;
                
                switch (signalType) {
                    case 'sine':
                        y = amplitude * Math.sin(2 * Math.PI * frequency * t + phase);
                        break;
                    case 'cosine':
                        y = amplitude * Math.cos(2 * Math.PI * frequency * t + phase);
                        break;
                    case 'square':
                        const harmonics = parseInt(document.getElementById('harmonics').value);
                        for (let n = 1; n <= harmonics; n += 2) {
                            y += (amplitude * 4 / Math.PI) * (1/n) * Math.sin(2 * Math.PI * n * frequency * t + phase);
                        }
                        break;
                    case 'sawtooth':
                        const sawHarmonics = parseInt(document.getElementById('harmonics').value);
                        for (let n = 1; n <= sawHarmonics; n++) {
                            y += (amplitude * 2 / Math.PI) * (Math.pow(-1, n+1) / n) * Math.sin(2 * Math.PI * n * frequency * t + phase);
                        }
                        break;
                    case 'triangle':
                        const triHarmonics = parseInt(document.getElementById('harmonics').value);
                        for (let n = 1; n <= triHarmonics; n += 2) {
                            y += (amplitude * 8 / (Math.PI * Math.PI)) * (Math.pow(-1, (n-1)/2) / (n*n)) * Math.sin(2 * Math.PI * n * frequency * t + phase);
                        }
                        break;
                    case 'gaussian':
                        const sigma = 0.1;
                        const mu = duration / 2;
                        y = amplitude * Math.exp(-0.5 * Math.pow((t - mu) / sigma, 2));
                        break;
                    case 'compound':
                        const freq2 = parseFloat(document.getElementById('freq2').value);
                        const amp2 = parseFloat(document.getElementById('amp2').value);
                        y = amplitude * Math.sin(2 * Math.PI * frequency * t + phase) + 
                            amp2 * Math.sin(2 * Math.PI * freq2 * t);
                        break;
                }
                
                timeData.push({t: t, y: y});
            }
            
            // Draw time domain
            drawTimeDomain(timeCtx, timeData, width, height);
            
            // Generate and draw frequency domain
            generateFrequencyDomain();
            drawFrequencyDomain(freqCtx, freqData, width, height);
        }

        function drawTimeDomain(ctx, data, width, height) {
            const padding = 20;
            const plotWidth = width - 2 * padding;
            const plotHeight = height - 2 * padding;
            
            // Draw axes
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, height / 2);
            ctx.lineTo(width - padding, height / 2);
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Draw grid
            ctx.strokeStyle = '#333333';
            ctx.lineWidth = 0.5;
            for (let i = 1; i < 5; i++) {
                const x = padding + (i * plotWidth / 4);
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, height - padding);
                ctx.stroke();
            }
            
            // Draw signal
            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < data.length; i++) {
                const x = padding + (data[i].t / 2) * plotWidth;
                const y = height / 2 - (data[i].y / 2) * (plotHeight / 2);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#ffffff';
            ctx.font = '12px Arial';
            ctx.fillText('t (s)', width - 30, height / 2 + 20);
            ctx.fillText('f(t)', 5, 15);
        }

        function generateFrequencyDomain() {
            // Simple frequency analysis for visualization
            freqData = [];
            const maxFreq = 20;
            const freqStep = 0.1;
            
            const signalType = document.getElementById('signalType').value;
            const frequency = parseFloat(document.getElementById('frequency').value);
            const amplitude = parseFloat(document.getElementById('amplitude').value);
            
            for (let f = 0; f <= maxFreq; f += freqStep) {
                let magnitude = 0;
                
                switch (signalType) {
                    case 'sine':
                    case 'cosine':
                        if (Math.abs(f - frequency) < 0.2) {
                            magnitude = amplitude;
                        }
                        break;
                    case 'square':
                        const harmonics = parseInt(document.getElementById('harmonics').value);
                        for (let n = 1; n <= harmonics; n += 2) {
                            if (Math.abs(f - n * frequency) < 0.2) {
                                magnitude += (amplitude * 4 / Math.PI) * (1/n);
                            }
                        }
                        break;
                    case 'sawtooth':
                        const sawHarmonics = parseInt(document.getElementById('harmonics').value);
                        for (let n = 1; n <= sawHarmonics; n++) {
                            if (Math.abs(f - n * frequency) < 0.2) {
                                magnitude += (amplitude * 2 / Math.PI) * (1/n);
                            }
                        }
                        break;
                    case 'triangle':
                        const triHarmonics = parseInt(document.getElementById('harmonics').value);
                        for (let n = 1; n <= triHarmonics; n += 2) {
                            if (Math.abs(f - n * frequency) < 0.2) {
                                magnitude += (amplitude * 8 / (Math.PI * Math.PI)) * (1/(n*n));
                            }
                        }
                        break;
                    case 'gaussian':
                        const sigma = 0.1 * 2 * Math.PI;
                        magnitude = amplitude * Math.exp(-0.5 * Math.pow(f * sigma, 2));
                        break;
                    case 'compound':
                        const freq2 = parseFloat(document.getElementById('freq2').value);
                        const amp2 = parseFloat(document.getElementById('amp2').value);
                        if (Math.abs(f - frequency) < 0.2) {
                            magnitude += amplitude;
                        }
                        if (Math.abs(f - freq2) < 0.2) {
                            magnitude += amp2;
                        }
                        break;
                }
                
                freqData.push({f: f, magnitude: Math.abs(magnitude)});
            }
        }

        function drawFrequencyDomain(ctx, data, width, height) {
            const padding = 20;
            const plotWidth = width - 2 * padding;
            const plotHeight = height - 2 * padding;
            
            // Draw axes
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Find max magnitude for scaling
            const maxMag = Math.max(...data.map(d => d.magnitude), 0.1);
            
            // Draw frequency bars
            ctx.fillStyle = '#ff6b6b';
            const barWidth = plotWidth / data.length;
            
            for (let i = 0; i < data.length; i++) {
                const x = padding + (data[i].f / 20) * plotWidth;
                const barHeight = (data[i].magnitude / maxMag) * plotHeight;
                const y = height - padding - barHeight;
                
                ctx.fillRect(x - barWidth/2, y, barWidth, barHeight);
            }
            
            // Labels
            ctx.fillStyle = '#ffffff';
            ctx.font = '12px Arial';
            ctx.fillText('f (Hz)', width - 30, height - 5);
            ctx.fillText('|F(ω)|', 5, 15);
        }

        // Music visualization
        function updateMusicVisualization() {
            const chordType = document.getElementById('chordType').value;
            let frequencies = [];
            let analysis = '';
            
            switch (chordType) {
                case 'C':
                    frequencies = [261.63, 329.63, 392.00]; // C4, E4, G4
                    analysis = 'Hợp âm C Major: Do (261.6Hz), Mi (329.6Hz), Sol (392.0Hz). Tỷ lệ tần số 4:5:6 tạo âm thanh hài hòa.';
                    break;
                case 'Am':
                    frequencies = [220.00, 261.63, 329.63]; // A3, C4, E4
                    analysis = 'Hợp âm A Minor: La (220.0Hz), Do (261.6Hz), Mi (329.6Hz). Minor chord có âm thanh buồn hơn major.';
                    break;
                case 'F':
                    frequencies = [174.61, 220.00, 261.63]; // F3, A3, C4
                    analysis = 'Hợp âm F Major: Fa (174.6Hz), La (220.0Hz), Do (261.6Hz). Hợp âm subdominant phổ biến.';
                    break;
                case 'G':
                    frequencies = [196.00, 246.94, 293.66]; // G3, B3, D4
                    analysis = 'Hợp âm G Major: Sol (196.0Hz), Si (246.9Hz), Re (293.7Hz). Hợp âm dominant mạnh mẽ.';
                    break;
                case 'Dm':
                    frequencies = [146.83, 174.61, 220.00]; // D3, F3, A3
                    analysis = 'Hợp âm D Minor: Re (146.8Hz), Fa (174.6Hz), La (220.0Hz). Minor chord với cảm giác u sầu.';
                    break;
            }
            
            document.getElementById('chordAnalysis').textContent = analysis;
            
            // Draw music signal and spectrum
            drawMusicSignal(frequencies);
        }

        function drawMusicSignal(frequencies) {
            const musicCanvas = document.getElementById('musicCanvas');
            const spectrumCanvas = document.getElementById('musicSpectrumCanvas');
            
            if (!musicCanvas || !spectrumCanvas) return;
            
            const musicCtx = musicCanvas.getContext('2d');
            const spectrumCtx = spectrumCanvas.getContext('2d');
            
            const width = musicCanvas.width;
            const height = musicCanvas.height;
            
            // Clear canvases
            musicCtx.clearRect(0, 0, width, height);
            spectrumCtx.clearRect(0, 0, width, height);
            
            // Generate chord signal
            const numPoints = 1000;
            const duration = 1; // 1 second
            const chordData = [];
            
            for (let i = 0; i < numPoints; i++) {
                const t = (i / numPoints) * duration;
                let y = 0;
                
                frequencies.forEach(freq => {
                    y += Math.sin(2 * Math.PI * freq * t) / frequencies.length;
                });
                
                chordData.push({t: t, y: y});
            }
            
            // Draw time domain
            drawTimeDomain(musicCtx, chordData, width, height);
            
            // Draw frequency spectrum
            drawMusicSpectrum(spectrumCtx, frequencies, width, height);
        }

        function drawMusicSpectrum(ctx, frequencies, width, height) {
            const padding = 20;
            const plotWidth = width - 2 * padding;
            const plotHeight = height - 2 * padding;
            
            // Draw axes
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Draw frequency peaks
            const maxFreq = 500;
            frequencies.forEach(freq => {
                const x = padding + (freq / maxFreq) * plotWidth;
                const barHeight = plotHeight * 0.8;
                const y = height - padding - barHeight;
                
                ctx.fillStyle = '#ff6b6b';
                ctx.fillRect(x - 2, y, 4, barHeight);
                
                // Label frequency
                ctx.fillStyle = '#ffffff';
                ctx.font = '10px Arial';
                ctx.fillText(freq.toFixed(0), x - 10, y - 5);
            });
            
            // Labels
            ctx.fillStyle = '#ffffff';
            ctx.font = '12px Arial';
            ctx.fillText('Tần số (Hz)', width - 80, height - 5);
        }

        // Filter demo
        function updateFilter() {
            const filterType = document.getElementById('filterType').value;
            const cutoffFreq = parseFloat(document.getElementById('cutoffFreq').value);
            const noiseLevel = parseFloat(document.getElementById('noiseLevel').value);
            
            document.getElementById('cutoffValue').textContent = cutoffFreq.toFixed(1) + ' Hz';
            document.getElementById('noiseValue').textContent = noiseLevel.toFixed(1);
            
            drawFilterDemo(filterType, cutoffFreq, noiseLevel);
        }

        function drawFilterDemo(filterType, cutoffFreq, noiseLevel) {
            const noisyCanvas = document.getElementById('noisyCanvas');
            const filteredCanvas = document.getElementById('filteredCanvas');
            
            if (!noisyCanvas || !filteredCanvas) return;
            
            const noisyCtx = noisyCanvas.getContext('2d');
            const filteredCtx = filteredCanvas.getContext('2d');
            
            const width = noisyCanvas.width;
            const height = noisyCanvas.height;
            
            // Clear canvases
            noisyCtx.clearRect(0, 0, width, height);
            filteredCtx.clearRect(0, 0, width, height);
            
            // Generate noisy signal
            const numPoints = 500;
            const duration = 2;
            const noisyData = [];
            const filteredData = [];
            
            for (let i = 0; i < numPoints; i++) {
                const t = (i / numPoints) * duration;
                
                // Original signal (low frequency)
                const originalSignal = Math.sin(2 * Math.PI * 2 * t);
                
                // Add noise (high frequency)
                const noise = noiseLevel * (Math.random() - 0.5) * 2;
                const highFreqNoise = noiseLevel * 0.3 * Math.sin(2 * Math.PI * 15 * t);
                
                const noisySignal = originalSignal + noise + highFreqNoise;
                
                // Apply filter
                let filteredSignal = noisySignal;
                switch (filterType) {
                    case 'lowpass':
                        // Simple approximation - in reality would use FFT
                        filteredSignal = originalSignal + noise * 0.1;
                        break;
                    case 'highpass':
                        filteredSignal = noise + highFreqNoise;
                        break;
                    case 'bandpass':
                        if (Math.abs(2 - cutoffFreq) < 1) {
                            filteredSignal = originalSignal;
                        } else {
                            filteredSignal = noise * 0.2;
                        }
                        break;
                    case 'notch':
                        if (Math.abs(2 - cutoffFreq) < 0.5) {
                            filteredSignal = noise + highFreqNoise;
                        } else {
                            filteredSignal = noisySignal;
                        }
                        break;
                }
                
                noisyData.push({t: t, y: noisySignal});
                filteredData.push({t: t, y: filteredSignal});
            }
            
            // Draw signals
            drawFilterSignal(noisyCtx, noisyData, width, height, '#ff6b6b');
            drawFilterSignal(filteredCtx, filteredData, width, height, '#64ff64');
        }

        function drawFilterSignal(ctx, data, width, height, color) {
            const padding = 20;
            const plotWidth = width - 2 * padding;
            const plotHeight = height - 2 * padding;
            
            // Draw axes
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, height / 2);
            ctx.lineTo(width - padding, height / 2);
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Draw signal
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < data.length; i++) {
                const x = padding + (data[i].t / 2) * plotWidth;
                const y = height / 2 - (data[i].y / 3) * (plotHeight / 2);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
        }

        // Update play button text based on waveform
        function updatePlayButtonText(waveform) {
            const button = document.getElementById('playFreqBtn');
            if (!button) return;
            
            switch (waveform) {
                case 'square':
                    button.textContent = '🔊 Play Square Wave (Odd Harmonics)';
                    break;
                case 'sawtooth':
                    button.textContent = '🔊 Play Sawtooth (All Harmonics)';
                    break;
                case 'triangle':
                    button.textContent = '🔊 Play Triangle Wave (Harmonics)';
                    break;
                case 'compound':
                    button.textContent = '🔊 Play Compound Signal';
                    break;
                default:
                    button.textContent = '🔊 Play Pure Tone';
                    break;
            }
        }

        // Audio context for sound generation
        let audioContext = null;
        let isPlaying = false;

        // Initialize Audio Context (requires user interaction)
        function initAudioContext() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.error('Web Audio API not supported:', e);
                    return false;
                }
            }
            
            // Resume context if suspended (required by browser policies)
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            return true;
        }

        // Create and play a tone with given frequency
        function playTone(frequency, duration = 1.0, volume = 0.1) {
            if (!initAudioContext()) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            // Configure oscillator
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            
            // Configure gain (volume) with envelope
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.05); // Attack
            gainNode.gain.linearRampToValueAtTime(volume * 0.8, audioContext.currentTime + 0.1); // Decay
            gainNode.gain.setValueAtTime(volume * 0.8, audioContext.currentTime + duration - 0.1); // Sustain
            gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + duration); // Release
            
            // Connect nodes
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Start and stop
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
            
            return oscillator;
        }

        // Play multiple tones simultaneously (chord)
        function playChord() {
            if (isPlaying) return; // Prevent overlapping
            
            const chordType = document.getElementById('chordType').value;
            let frequencies = [];
            
            switch (chordType) {
                case 'C': frequencies = [261.63, 329.63, 392.00]; break;
                case 'Am': frequencies = [220.00, 261.63, 329.63]; break;
                case 'F': frequencies = [174.61, 220.00, 261.63]; break;
                case 'G': frequencies = [196.00, 246.94, 293.66]; break;
                case 'Dm': frequencies = [146.83, 174.61, 220.00]; break;
            }
            
            if (!initAudioContext()) {
                alert(`Audio not supported. Chord ${chordType} frequencies: ${frequencies.map(f => f.toFixed(1)).join(', ')} Hz`);
                return;
            }
            
            isPlaying = true;
            const duration = 2.0;
            
            // Update button text
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = `Playing ${chordType}...`;
            button.disabled = true;
            
            // Play each frequency in the chord
            frequencies.forEach((freq, index) => {
                playTone(freq, duration, 0.08); // Lower volume for multiple tones
            });
            
            // Reset button after duration
            setTimeout(() => {
                isPlaying = false;
                button.textContent = originalText;
                button.disabled = false;
            }, duration * 1000);
        }

        // Add function to play single frequency (useful for demonstrations)
        function playSingleTone() {
            const frequency = parseFloat(document.getElementById('frequency').value);
            const amplitude = parseFloat(document.getElementById('amplitude').value);
            const waveform = document.getElementById('signalType').value;
            
            if (!initAudioContext()) {
                alert(`Audio not supported. Would play ${frequency.toFixed(1)} Hz`);
                return;
            }
            
            // For different waveforms, play harmonics
            if (waveform === 'square') {
                playHarmonics(frequency, amplitude, 'square');
            } else if (waveform === 'sawtooth') {
                playHarmonics(frequency, amplitude, 'sawtooth');
            } else if (waveform === 'triangle') {
                playHarmonics(frequency, amplitude, 'triangle');
            } else {
                // Scale amplitude to reasonable volume
                const volume = Math.min(amplitude * 0.1, 0.2);
                playTone(frequency, 1.5, volume);
            }
        }

        // Play harmonic series for complex waveforms
        function playHarmonics(fundamentalFreq, amplitude, waveType) {
            if (!initAudioContext()) return;
            
            const duration = 2.0;
            const baseVolume = Math.min(amplitude * 0.05, 0.1); // Lower volume for multiple harmonics
            
            let harmonics = [];
            
            switch (waveType) {
                case 'square':
                    // Odd harmonics only: 1, 3, 5, 7, 9...
                    for (let n = 1; n <= 9; n += 2) {
                        harmonics.push({
                            freq: fundamentalFreq * n,
                            amplitude: 1 / n // Decreasing amplitude
                        });
                    }
                    break;
                    
                case 'sawtooth':
                    // All harmonics: 1, 2, 3, 4, 5...
                    for (let n = 1; n <= 8; n++) {
                        harmonics.push({
                            freq: fundamentalFreq * n,
                            amplitude: 1 / n // Decreasing amplitude
                        });
                    }
                    break;
                    
                case 'triangle':
                    // Odd harmonics with different phase: 1, 3, 5, 7...
                    for (let n = 1; n <= 7; n += 2) {
                        harmonics.push({
                            freq: fundamentalFreq * n,
                            amplitude: 1 / (n * n) // Faster decreasing amplitude
                        });
                    }
                    break;
            }
            
            // Play each harmonic
            harmonics.forEach(harmonic => {
                const volume = baseVolume * harmonic.amplitude;
                playTone(harmonic.freq, duration, volume);
            });
        }

        // Initialize when page loads
        window.addEventListener('load', function() {
            initCanvases();
        });

        // Component Analysis Functions
        let currentComponents = [];
        let animationSpeed = 1.0;
        let componentAnimationId = null;

        // Update animation speed
        function updateAnimationSpeed() {
            animationSpeed = parseFloat(document.getElementById('animationSpeed').value);
            document.getElementById('animSpeedValue').textContent = animationSpeed.toFixed(1) + 'x';
        }

        // Update components display
        function updateComponentsDisplay() {
            drawComponentsVisualization();
        }

        // Calculate and display current signal components
        function updateComponentsList() {
            const signalType = document.getElementById('signalType').value;
            const frequency = parseFloat(document.getElementById('frequency').value);
            const amplitude = parseFloat(document.getElementById('amplitude').value);
            
            currentComponents = [];
            
            switch (signalType) {
                case 'sine':
                case 'cosine':
                    currentComponents.push({
                        type: 'fundamental',
                        frequency: frequency,
                        amplitude: amplitude,
                        harmonicNumber: 1,
                        phase: signalType === 'cosine' ? 0 : -Math.PI/2
                    });
                    break;
                    
                case 'square':
                    // Odd harmonics: 1, 3, 5, 7, 9...
                    for (let n = 1; n <= 9; n += 2) {
                        currentComponents.push({
                            type: n === 1 ? 'fundamental' : 'harmonic',
                            frequency: frequency * n,
                            amplitude: amplitude * (1 / n),
                            harmonicNumber: n,
                            phase: 0
                        });
                    }
                    break;
                    
                case 'sawtooth':
                    // All harmonics: 1, 2, 3, 4, 5...
                    for (let n = 1; n <= 8; n++) {
                        currentComponents.push({
                            type: n === 1 ? 'fundamental' : 'harmonic',
                            frequency: frequency * n,
                            amplitude: amplitude * (1 / n),
                            harmonicNumber: n,
                            phase: 0
                        });
                    }
                    break;
                    
                case 'triangle':
                    // Odd harmonics with different amplitude: 1, 3, 5, 7...
                    for (let n = 1; n <= 7; n += 2) {
                        currentComponents.push({
                            type: n === 1 ? 'fundamental' : 'harmonic',
                            frequency: frequency * n,
                            amplitude: amplitude * (1 / (n * n)),
                            harmonicNumber: n,
                            phase: 0
                        });
                    }
                    break;
                    
                case 'compound':
                    const freq2 = parseFloat(document.getElementById('freq2').value);
                    const amp2 = parseFloat(document.getElementById('amp2').value);
                    currentComponents.push({
                        type: 'fundamental',
                        frequency: frequency,
                        amplitude: amplitude,
                        harmonicNumber: 1,
                        phase: 0
                    });
                    currentComponents.push({
                        type: 'fundamental',
                        frequency: freq2,
                        amplitude: amp2,
                        harmonicNumber: Math.round(freq2 / frequency),
                        phase: 0
                    });
                    break;
            }
            
            renderComponentsList();
            drawComponentsVisualization();
        }

        // Render the components list UI
        function renderComponentsList() {
            const container = document.getElementById('componentsContainer');
            
            if (currentComponents.length === 0) {
                container.innerHTML = '<p>No components to display</p>';
                return;
            }
            
            let html = '';
            currentComponents.forEach((component, index) => {
                const freq = component.frequency.toFixed(1);
                const amp = component.amplitude.toFixed(3);
                const harmonic = component.harmonicNumber;
                
                html += `
                    <div class="component-item ${component.type}" id="component-${index}">
                        <div class="component-info">
                            <strong>${component.type === 'fundamental' ? 'Fundamental' : 'Harmonic'} ${harmonic}</strong><br>
                            <small>${freq} Hz | Amplitude: ${amp}</small>
                        </div>
                        <div class="component-controls">
                            <button class="component-btn play-btn" onclick="playComponent(${index})">
                                🔊 Play
                            </button>
                            <button class="component-btn toggle-btn" id="toggle-${index}" onclick="toggleComponent(${index})">
                                ✓ On
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Play individual component
        function playComponent(index) {
            if (index >= currentComponents.length) return;
            
            const component = currentComponents[index];
            if (!initAudioContext()) {
                alert(`Audio not supported. Component ${component.harmonicNumber}: ${component.frequency.toFixed(1)} Hz`);
                return;
            }
            
            const volume = Math.min(component.amplitude * 0.15, 0.2);
            playTone(component.frequency, 1.5, volume);
        }

        // Toggle component visibility/audibility
        function toggleComponent(index) {
            const button = document.getElementById(`toggle-${index}`);
            const component = currentComponents[index];
            
            component.enabled = !component.enabled;
            
            if (component.enabled) {
                button.textContent = '✓ On';
                button.classList.remove('disabled');
            } else {
                button.textContent = '✗ Off';
                button.classList.add('disabled');
            }
            
            drawComponentsVisualization();
        }

        // Play all components sequentially
        function playAllComponents() {
            if (currentComponents.length === 0) return;
            
            let index = 0;
            const playNext = () => {
                if (index < currentComponents.length) {
                    playComponent(index);
                    
                    // Highlight current component
                    document.querySelectorAll('.component-item').forEach(item => {
                        item.style.background = 'rgba(255, 255, 255, 0.1)';
                    });
                    
                    const currentItem = document.getElementById(`component-${index}`);
                    if (currentItem) {
                        currentItem.style.background = 'rgba(255, 215, 0, 0.3)';
                    }
                    
                    index++;
                    setTimeout(playNext, 1800); // Delay between components
                } else {
                    // Reset highlighting
                    document.querySelectorAll('.component-item').forEach(item => {
                        item.style.background = 'rgba(255, 255, 255, 0.1)';
                    });
                }
            };
            
            playNext();
        }

        // Play composite sound (all components together)
        function playCompositeSound() {
            if (!initAudioContext()) {
                alert('Audio not supported');
                return;
            }
            
            const duration = 2.0;
            const baseVolume = 0.08;
            
            currentComponents.forEach(component => {
                if (component.enabled !== false) {
                    const volume = baseVolume * component.amplitude;
                    playTone(component.frequency, duration, volume);
                }
            });
        }

        // Draw components visualization
        function drawComponentsVisualization() {
            const canvas = document.getElementById('componentsCanvas');
            const compositeCanvas = document.getElementById('compositeCanvas');
            
            if (!canvas || !compositeCanvas) return;
            
            const ctx = canvas.getContext('2d');
            const compositeCtx = compositeCanvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const compositeHeight = compositeCanvas.height;
            
            // Clear canvases
            ctx.clearRect(0, 0, width, height);
            compositeCtx.clearRect(0, 0, width, compositeHeight);
            
            if (currentComponents.length === 0) return;
            
            const showFundamental = document.getElementById('showFundamental').checked;
            const showHarmonics = document.getElementById('showHarmonics').checked;
            const showSum = document.getElementById('showSum').checked;
            
            const numPoints = 500;
            const timeRange = 2; // seconds
            const dt = timeRange / numPoints;
            
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD93D', '#6BCF7F', '#4D96FF', '#9C88FF', '#FF9F40', '#FF6384'];
            
            // Draw individual components
            let yOffset = 40;
            const componentHeight = (height - 80) / Math.min(currentComponents.length, 6);
            
            currentComponents.forEach((component, index) => {
                if (component.enabled === false) return;
                
                const shouldShow = (component.type === 'fundamental' && showFundamental) || 
                                 (component.type === 'harmonic' && showHarmonics);
                
                if (!shouldShow) return;
                
                const y = yOffset + index * componentHeight;
                const amplitude = component.amplitude * (componentHeight * 0.3);
                
                ctx.strokeStyle = colors[index % colors.length];
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let i = 0; i < numPoints; i++) {
                    const t = i * dt;
                    const x = (i / numPoints) * width;
                    const value = amplitude * Math.sin(2 * Math.PI * component.frequency * t + component.phase);
                    const plotY = y + componentHeight/2 - value;
                    
                    if (i === 0) {
                        ctx.moveTo(x, plotY);
                    } else {
                        ctx.lineTo(x, plotY);
                    }
                }
                ctx.stroke();
                
                // Label
                ctx.fillStyle = colors[index % colors.length];
                ctx.font = '12px Arial';
                ctx.fillText(`${component.frequency.toFixed(1)} Hz`, 5, y + 15);
            });
            
            // Draw composite signal
            if (showSum && currentComponents.length > 1) {
                const compositeData = new Array(numPoints).fill(0);
                
                currentComponents.forEach(component => {
                    if (component.enabled === false) return;
                    
                    for (let i = 0; i < numPoints; i++) {
                        const t = i * dt;
                        const value = component.amplitude * Math.sin(2 * Math.PI * component.frequency * t + component.phase);
                        compositeData[i] += value;
                    }
                });
                
                // Normalize
                const maxVal = Math.max(...compositeData.map(Math.abs));
                const scale = (compositeHeight * 0.4) / (maxVal || 1);
                
                compositeCtx.strokeStyle = '#FF6B6B';
                compositeCtx.lineWidth = 3;
                compositeCtx.beginPath();
                
                for (let i = 0; i < numPoints; i++) {
                    const x = (i / numPoints) * width;
                    const y = compositeHeight/2 - compositeData[i] * scale;
                    
                    if (i === 0) {
                        compositeCtx.moveTo(x, y);
                    } else {
                        compositeCtx.lineTo(x, y);
                    }
                }
                compositeCtx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 1;
            compositeCtx.strokeStyle = '#ffffff';
            compositeCtx.lineWidth = 1;
            
            // Time axis for components
            ctx.beginPath();
            ctx.moveTo(0, height - 20);
            ctx.lineTo(width, height - 20);
            ctx.stroke();
            
            // Time axis for composite
            compositeCtx.beginPath();
            compositeCtx.moveTo(0, compositeHeight - 20);
            compositeCtx.lineTo(width, compositeHeight - 20);
            compositeCtx.stroke();
        }

        // Initialize components when signal changes
        function initializeComponents() {
            // Initialize enabled state for all components
            currentComponents.forEach(component => {
                component.enabled = true;
            });
            updateComponentsList();
        }

        // Enhanced Music Chord Analysis Functions
        let currentChordNotes = [];
        let noteDuration = 1.5;
        let chordVolume = 0.15;

        // Note names and their frequencies
        const noteFrequencies = {
            'C': 261.63, 'C#': 277.18, 'D': 293.66, 'D#': 311.13, 'E': 329.63, 'F': 349.23,
            'F#': 369.99, 'G': 392.00, 'G#': 415.30, 'A': 440.00, 'A#': 466.16, 'B': 493.88
        };

        // Get chord frequencies and note names
        function getChordInfo(chordType) {
            const chordDefinitions = {
                'C': { frequencies: [261.63, 329.63, 392.00], notes: ['C', 'E', 'G'], fullName: 'C Major' },
                'Am': { frequencies: [220.00, 261.63, 329.63], notes: ['A', 'C', 'E'], fullName: 'A Minor' },
                'F': { frequencies: [174.61, 220.00, 261.63], notes: ['F', 'A', 'C'], fullName: 'F Major' },
                'G': { frequencies: [196.00, 246.94, 293.66], notes: ['G', 'B', 'D'], fullName: 'G Major' },
                'Dm': { frequencies: [146.83, 174.61, 220.00], notes: ['D', 'F', 'A'], fullName: 'D Minor' }
            };
            
            return chordDefinitions[chordType] || chordDefinitions['C'];
        }

        // Update note duration
        function updateNoteDuration() {
            noteDuration = parseFloat(document.getElementById('noteDuration').value);
            document.getElementById('noteDurationValue').textContent = noteDuration.toFixed(1) + 's';
        }

        // Update chord volume
        function updateChordVolume() {
            chordVolume = parseFloat(document.getElementById('chordVolume').value);
            document.getElementById('chordVolumeValue').textContent = chordVolume.toFixed(2);
        }

        // Play chord components separately
        function playChordComponents() {
            const chordType = document.getElementById('chordType').value;
            const chordInfo = getChordInfo(chordType);
            
            if (!initAudioContext()) {
                alert(`Audio not supported. ${chordInfo.fullName} notes: ${chordInfo.notes.join('-')}`);
                return;
            }
            
            // Play each note separately with delay
            chordInfo.frequencies.forEach((freq, index) => {
                setTimeout(() => {
                    playTone(freq, noteDuration * 0.8, chordVolume);
                    
                    // Highlight current note
                    highlightNote(index);
                }, index * 600);
            });
        }

        // Play individual note
        function playNote(noteIndex) {
            const chordType = document.getElementById('chordType').value;
            const chordInfo = getChordInfo(chordType);
            
            if (noteIndex >= chordInfo.frequencies.length) return;
            
            if (!initAudioContext()) {
                alert(`Audio not supported. Note: ${chordInfo.notes[noteIndex]} (${chordInfo.frequencies[noteIndex].toFixed(1)} Hz)`);
                return;
            }
            
            playTone(chordInfo.frequencies[noteIndex], noteDuration, chordVolume);
            highlightNote(noteIndex);
        }

        // Highlight note during playback
        function highlightNote(noteIndex) {
            // Reset all highlights
            document.querySelectorAll('.chord-note-item').forEach(item => {
                item.style.background = 'rgba(255, 255, 255, 0.1)';
            });
            
            // Highlight current note
            const noteItem = document.querySelector(`.note${noteIndex + 1}`);
            if (noteItem) {
                noteItem.style.background = 'rgba(255, 215, 0, 0.3)';
                
                // Remove highlight after duration
                setTimeout(() => {
                    noteItem.style.background = 'rgba(255, 255, 255, 0.1)';
                }, noteDuration * 1000);
            }
        }

        // Play all notes sequentially
        function playAllNotesSequential() {
            const chordType = document.getElementById('chordType').value;
            const chordInfo = getChordInfo(chordType);
            
            if (!initAudioContext()) {
                alert(`Audio not supported. Sequential notes: ${chordInfo.notes.join(' → ')}`);
                return;
            }
            
            chordInfo.frequencies.forEach((freq, index) => {
                setTimeout(() => {
                    playTone(freq, noteDuration, chordVolume);
                    highlightNote(index);
                }, index * (noteDuration * 1000 + 200));
            });
        }

        // Play arpeggio (faster sequential)
        function playArpeggio() {
            const chordType = document.getElementById('chordType').value;
            const chordInfo = getChordInfo(chordType);
            
            if (!initAudioContext()) {
                alert(`Audio not supported. Arpeggio: ${chordInfo.notes.join(' → ')}`);
                return;
            }
            
            const arpeggioSpeed = 400; // milliseconds between notes
            
            chordInfo.frequencies.forEach((freq, index) => {
                setTimeout(() => {
                    playTone(freq, 0.8, chordVolume);
                    highlightNote(index);
                }, index * arpeggioSpeed);
            });
        }

        // Update chord notes display
        function updateChordNotesDisplay() {
            const chordType = document.getElementById('chordType').value;
            const chordInfo = getChordInfo(chordType);
            const container = document.getElementById('chordNotesContainer');
            
            let html = '';
            chordInfo.frequencies.forEach((freq, index) => {
                const note = chordInfo.notes[index];
                html += `
                    <div class="chord-note-item note${index + 1}">
                        <div class="note-info">
                            <strong>${note}</strong><br>
                            <small>${freq.toFixed(1)} Hz</small>
                        </div>
                        <div class="note-controls">
                            <button class="note-btn" onclick="playNote(${index})">
                                🔊 Play
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Update analysis text
            const analysisText = `${chordInfo.fullName}: ${chordInfo.notes.join(' - ')} (${chordInfo.frequencies.map(f => f.toFixed(1) + ' Hz').join(', ')})`;
            document.getElementById('chordAnalysis').textContent = analysisText;
            
            // Update visualization
            drawChordComponents();
        }

        // Draw chord components visualization
        function drawChordComponents() {
            const chordComponentsCanvas = document.getElementById('chordComponentsCanvas');
            const chordCompositeCanvas = document.getElementById('chordCompositeCanvas');
            
            if (!chordComponentsCanvas || !chordCompositeCanvas) return;
            
            const ctx = chordComponentsCanvas.getContext('2d');
            const compositeCtx = chordCompositeCanvas.getContext('2d');
            const width = chordComponentsCanvas.width;
            const height = chordComponentsCanvas.height;
            const compositeHeight = chordCompositeCanvas.height;
            
            // Clear canvases
            ctx.clearRect(0, 0, width, height);
            compositeCtx.clearRect(0, 0, width, compositeHeight);
            
            const chordType = document.getElementById('chordType').value;
            const chordInfo = getChordInfo(chordType);
            
            const numPoints = 500;
            const timeRange = 1; // seconds
            const dt = timeRange / numPoints;
            
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD93D'];
            const componentHeight = height / 3;
            
            // Draw individual notes
            chordInfo.frequencies.forEach((freq, index) => {
                const y = index * componentHeight + componentHeight / 2;
                const amplitude = componentHeight * 0.3;
                
                ctx.strokeStyle = colors[index];
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let i = 0; i < numPoints; i++) {
                    const t = i * dt;
                    const x = (i / numPoints) * width;
                    const value = amplitude * Math.sin(2 * Math.PI * freq * t);
                    const plotY = y - value;
                    
                    if (i === 0) {
                        ctx.moveTo(x, plotY);
                    } else {
                        ctx.lineTo(x, plotY);
                    }
                }
                ctx.stroke();
                
                // Label
                ctx.fillStyle = colors[index];
                ctx.font = '14px Arial';
                ctx.fillText(`${chordInfo.notes[index]} (${freq.toFixed(1)} Hz)`, 5, y - componentHeight/2 + 20);
            });
            
            // Draw composite signal
            const compositeData = new Array(numPoints).fill(0);
            
            chordInfo.frequencies.forEach((freq, index) => {
                for (let i = 0; i < numPoints; i++) {
                    const t = i * dt;
                    const value = Math.sin(2 * Math.PI * freq * t);
                    compositeData[i] += value;
                }
            });
            
            // Normalize
            const maxVal = Math.max(...compositeData.map(Math.abs));
            const scale = (compositeHeight * 0.4) / (maxVal || 1);
            
            compositeCtx.strokeStyle = '#FF6B6B';
            compositeCtx.lineWidth = 3;
            compositeCtx.beginPath();
            
            for (let i = 0; i < numPoints; i++) {
                const x = (i / numPoints) * width;
                const y = compositeHeight/2 - compositeData[i] * scale;
                
                if (i === 0) {
                    compositeCtx.moveTo(x, y);
                } else {
                    compositeCtx.lineTo(x, y);
                }
            }
            compositeCtx.stroke();
            
            // Draw center lines
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 1;
            for (let i = 0; i < 3; i++) {
                const y = i * componentHeight + componentHeight / 2;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            compositeCtx.strokeStyle = '#ffffff';
            compositeCtx.lineWidth = 1;
            compositeCtx.beginPath();
            compositeCtx.moveTo(0, compositeHeight / 2);
            compositeCtx.lineTo(width, compositeHeight / 2);
            compositeCtx.stroke();
        }

        // Enhance the existing updateMusicVisualization to include chord components
        const originalUpdateMusicVisualization = updateMusicVisualization;
        updateMusicVisualization = function() {
            if (originalUpdateMusicVisualization) {
                originalUpdateMusicVisualization();
            }
            updateChordNotesDisplay();
        };

        // Complex Number Demonstrations
        function updateComplexDemo() {
            const canvas = document.getElementById('complexCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = 600;
            const height = canvas.height = 400;
            const centerX = width / 2;
            const centerY = height / 2;
            const scale = 80;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            // Get parameters
            const amplitude = parseFloat(document.getElementById('complexAmplitude')?.value || 1);
            const frequency = parseFloat(document.getElementById('complexFrequency')?.value || 1);
            const phase = parseFloat(document.getElementById('complexPhase')?.value || 0);
            const time = Date.now() / 1000; // Current time
            
            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            // Draw grid
            ctx.strokeStyle = '#f0f0f0';
            for (let i = -3; i <= 3; i++) {
                if (i !== 0) {
                    ctx.beginPath();
                    ctx.moveTo(centerX + i * scale, 0);
                    ctx.lineTo(centerX + i * scale, height);
                    ctx.moveTo(0, centerY + i * scale);
                    ctx.lineTo(width, centerY + i * scale);
                    ctx.stroke();
                }
            }
            
            // Calculate complex exponential
            const angle = 2 * Math.PI * frequency * time + phase;
            const realPart = amplitude * Math.cos(angle);
            const imagPart = amplitude * Math.sin(angle);
            
            // Draw rotating vector (phasor)
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX + realPart * scale, centerY - imagPart * scale);
            ctx.stroke();
            
            // Draw point
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.arc(centerX + realPart * scale, centerY - imagPart * scale, 5, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw projections
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            
            // Real projection
            ctx.beginPath();
            ctx.moveTo(centerX + realPart * scale, centerY - imagPart * scale);
            ctx.lineTo(centerX + realPart * scale, centerY);
            ctx.stroke();
            
            // Imaginary projection
            ctx.beginPath();
            ctx.moveTo(centerX + realPart * scale, centerY - imagPart * scale);
            ctx.lineTo(centerX, centerY - imagPart * scale);
            ctx.stroke();
            
            ctx.setLineDash([]);
            
            // Labels
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Real', width - 30, centerY - 10);
            ctx.save();
            ctx.translate(20, 20);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Imaginary', 0, 0);
            ctx.restore();
            
            // Display values
            const valuesElement = document.getElementById('complexValues');
            if (valuesElement) {
                valuesElement.innerHTML = `
                    Real: ${realPart.toFixed(3)}<br>
                    Imaginary: ${imagPart.toFixed(3)}<br>
                    Magnitude: ${amplitude.toFixed(3)}<br>
                    Phase: ${(angle % (2 * Math.PI)).toFixed(3)} rad
                `;
            }
            
            requestAnimationFrame(updateComplexDemo);
        }
        
        function updateGaussianDemo() {
            const canvas = document.getElementById('gaussianCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = 800;
            const height = canvas.height = 400;
            
            ctx.clearRect(0, 0, width, height);
            
            // Get parameters
            const sigma = parseFloat(document.getElementById('gaussianSigma')?.value || 1);
            const showFT = document.getElementById('showGaussianFT')?.checked || false;
            
            const timeScale = 40;
            const freqScale = 200;
            const centerY = height / 2;
            
            // Time domain
            if (!showFT) {
                ctx.strokeStyle = '#2980b9';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let x = 0; x < width; x++) {
                    const t = (x - width/2) / timeScale;
                    const amplitude = Math.exp(-t*t / (2 * sigma*sigma));
                    const y = centerY - amplitude * centerY * 0.8;
                    
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
                
                // Axes and labels
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, centerY);
                ctx.lineTo(width, centerY);
                ctx.moveTo(width/2, 0);
                ctx.lineTo(width/2, height);
                ctx.stroke();
                
                ctx.fillStyle = '#333';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Gaussian Pulse (Time Domain)', width/2, 30);
                ctx.fillText('σ = ' + sigma, width/2, height - 20);
            } else {
                // Frequency domain (Fourier Transform of Gaussian)
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let x = 0; x < width; x++) {
                    const f = (x - width/2) / freqScale;
                    const amplitude = sigma * Math.sqrt(2 * Math.PI) * Math.exp(-2 * Math.PI*Math.PI * f*f * sigma*sigma);
                    const y = centerY - amplitude * 20;
                    
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
                
                // Axes and labels
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, centerY);
                ctx.lineTo(width, centerY);
                ctx.moveTo(width/2, 0);
                ctx.lineTo(width/2, height);
                ctx.stroke();
                
                ctx.fillStyle = '#333';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Fourier Transform (Frequency Domain)', width/2, 30);
                ctx.fillText('1/σ width scaling', width/2, height - 20);
            }
        }
        
        function updateSquareWaveDemo() {
            const canvas = document.getElementById('squareWaveCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = 800;
            const height = canvas.height = 600;
            
            ctx.clearRect(0, 0, width, height);
            
            const harmonics = parseInt(document.getElementById('harmonicCount')?.value || 5);
            const showComponents = document.getElementById('showComponents')?.checked || false;
            
            const timeScale = 200;
            const amplitude = 100;
            const centerY = height / 3;
            
            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.moveTo(width/2, 0);
            ctx.lineTo(width/2, height/2);
            ctx.stroke();
            
            // Square wave synthesis
            const points = [];
            for (let x = 0; x < width; x++) {
                const t = (x - width/2) / timeScale;
                let y = 0;
                
                // Add harmonics
                for (let n = 1; n <= harmonics; n += 2) {
                    const harmonic = (4 / (n * Math.PI)) * Math.sin(2 * Math.PI * n * t);
                    y += harmonic;
                    
                    // Draw individual components if requested
                    if (showComponents && n <= 5) {
                        ctx.strokeStyle = `hsl(${n * 60}, 70%, 50%)`;
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        
                        for (let x2 = 0; x2 < width; x2++) {
                            const t2 = (x2 - width/2) / timeScale;
                            const comp = (4 / (n * Math.PI)) * Math.sin(2 * Math.PI * n * t2);
                            const y2 = centerY - comp * amplitude;
                            
                            if (x2 === 0) ctx.moveTo(x2, y2);
                            else ctx.lineTo(x2, y2);
                        }
                        ctx.stroke();
                    }
                }
                
                points.push({x, y: centerY - y * amplitude});
            }
            
            // Draw synthesized wave
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            points.forEach((point, i) => {
                if (i === 0) ctx.moveTo(point.x, point.y);
                else ctx.lineTo(point.x, point.y);
            });
            ctx.stroke();
            
            // Draw ideal square wave for comparison
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            
            for (let x = 0; x < width; x++) {
                const t = (x - width/2) / timeScale;
                const square = Math.sign(Math.sin(2 * Math.PI * t));
                const y = centerY - square * amplitude;
                
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Frequency spectrum
            const spectrumY = height * 2/3;
            const spectrumHeight = height/4;
            
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Frequency Spectrum', width/2, spectrumY - 20);
            
            // Draw spectrum
            for (let n = 1; n <= harmonics; n += 2) {
                const magnitude = 4 / (n * Math.PI);
                const x = width/2 + (n - harmonics/2) * 40;
                const barHeight = magnitude * spectrumHeight * 2;
                
                ctx.fillStyle = '#3498db';
                ctx.fillRect(x - 10, spectrumY + spectrumHeight - barHeight, 20, barHeight);
                
                ctx.fillStyle = '#333';
                ctx.font = '10px Arial';
                ctx.fillText(n.toString(), x, spectrumY + spectrumHeight + 15);
            }
            
            // Draw spectrum axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, spectrumY + spectrumHeight);
            ctx.lineTo(width, spectrumY + spectrumHeight);
            ctx.stroke();
        }
        
        // Initialize complex demos when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateComplexDemo();
                updateGaussianDemo();
                updateSquareWaveDemo();
                
                // Set up event listeners for controls
                const complexControls = ['complexAmplitude', 'complexFrequency', 'complexPhase'];
                complexControls.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', updateComplexDemo);
                    }
                });
                
                const gaussianControls = ['gaussianSigma', 'showGaussianFT'];
                gaussianControls.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', updateGaussianDemo);
                        element.addEventListener('change', updateGaussianDemo);
                    }
                });
                
                const squareWaveControls = ['harmonicCount', 'showComponents'];
                squareWaveControls.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', updateSquareWaveDemo);
                        element.addEventListener('change', updateSquareWaveDemo);
                    }
                });
            }, 100);
        });

        // MathJax configuration
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
</body>
</html>
