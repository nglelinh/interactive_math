<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ù Diffie-Hellman Key Exchange</title>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 50%, #3182ce 100%);
            color: #ffffff;
            min-height: 100vh;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #f7fafc;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 30px 0;
        }
        
        .three-column {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(247, 250, 252, 0.3);
        }
        
        .alice-panel {
            border-left: 4px solid #48bb78;
        }
        
        .bob-panel {
            border-left: 4px solid #ed8936;
        }
        
        .eve-panel {
            border-left: 4px solid #f56565;
        }
        
        .control-group {
            margin: 15px 0;
        }
        
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #e2e8f0;
        }
        
        .control-group input, .control-group select {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #4a5568;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            box-sizing: border-box;
        }
        
        .btn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin: 5px;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-alice {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .btn-bob {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }
        
        .btn-eve {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            width: auto;
        }
        
        .result-panel {
            background: rgba(66, 153, 225, 0.1);
            border: 1px solid #4299e1;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .result-panel.alice {
            background: rgba(72, 187, 120, 0.1);
            border-color: #48bb78;
        }
        
        .result-panel.bob {
            background: rgba(237, 137, 54, 0.1);
            border-color: #ed8936;
        }
        
        .result-panel.eve {
            background: rgba(245, 101, 101, 0.1);
            border-color: #f56565;
        }
        
        .key-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            border-left: 3px solid #4299e1;
            word-break: break-all;
            font-size: 14px;
        }
        
        .math-formula {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-family: 'Times New Roman', serif;
        }
        
        .protocol-step {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #4299e1;
        }
        
        .protocol-step h4 {
            margin: 0 0 10px 0;
            color: #4299e1;
        }
        
        .exchange-visualization {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .participant {
            text-align: center;
            padding: 15px;
            background: rgba(66, 153, 225, 0.2);
            border-radius: 8px;
            min-width: 120px;
        }
        
        .participant.alice {
            background: rgba(72, 187, 120, 0.2);
        }
        
        .participant.bob {
            background: rgba(237, 137, 54, 0.2);
        }
        
        .arrow {
            font-size: 24px;
            color: #4299e1;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .security-analysis {
            background: rgba(245, 101, 101, 0.1);
            border: 1px solid #f56565;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .vulnerability-demo {
            background: rgba(255, 215, 0, 0.1);
            border: 2px dashed #ffd700;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .timeline {
            position: relative;
            margin: 20px 0;
        }
        
        .timeline-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4299e1;
            position: relative;
        }
        
        .timeline-item::before {
            content: attr(data-step);
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            background: #4299e1;
            color: #1a202c;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #4299e1 100%);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        @media (max-width: 768px) {
            .demo-grid,
            .three-column {
                grid-template-columns: 1fr;
            }
            
            .exchange-visualization {
                flex-direction: column;
                gap: 15px;
            }
            
            .arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ù Diffie-Hellman Key Exchange</h1>
        <div style="text-align: center; color: #cbd5e0; font-size: 1.2em; margin-bottom: 30px;">
            Secure key establishment over insecure channels
        </div>
        
        <div class="demo-grid">
            <div class="control-panel">
                <h3>üîß Protocol Parameters</h3>
                
                <div class="control-group">
                    <label>Prime Number (p):</label>
                    <input type="number" id="primeP" value="23" min="2" max="10000">
                </div>
                
                <div class="control-group">
                    <label>Generator (g):</label>
                    <input type="number" id="generatorG" value="5" min="2" max="100">
                </div>
                
                <div class="control-group">
                    <label>Key Size:</label>
                    <select id="keySize" onchange="updateKeySize()">
                        <option value="small">Small (for demo)</option>
                        <option value="1024">1024 bits</option>
                        <option value="2048" selected>2048 bits</option>
                        <option value="3072">3072 bits</option>
                    </select>
                </div>
                
                <button class="btn" onclick="generateParameters()">üé≤ Generate Safe Parameters</button>
                <button class="btn btn-small" onclick="generateWellKnownParams()">üìö Use Well-Known</button>
                
                <div class="math-formula">
                    <h4>üìê Mathematical Foundation:</h4>
                    <p>Shared Secret = g<sup>ab</sup> mod p</p>
                    <p>Where:</p>
                    <p>‚Ä¢ p = large prime number</p>
                    <p>‚Ä¢ g = generator (primitive root)</p>
                    <p>‚Ä¢ a, b = private keys</p>
                </div>
                
                <div class="result-panel">
                    <h4>üîç Parameter Analysis:</h4>
                    <div id="parameterAnalysis">Configure parameters to see analysis</div>
                </div>
            </div>
            
            <div class="control-panel">
                <h3>üîÑ Protocol Execution</h3>
                
                <div class="control-group">
                    <label>Protocol Step:</label>
                    <select id="protocolStep" onchange="updateProtocolInfo()">
                        <option value="0">0. Initial Setup</option>
                        <option value="1">1. Public Parameters</option>
                        <option value="2">2. Private Key Generation</option>
                        <option value="3">3. Public Key Calculation</option>
                        <option value="4">4. Key Exchange</option>
                        <option value="5">5. Shared Secret</option>
                    </select>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="protocolProgress"></div>
                </div>
                
                <button class="btn" onclick="executeFullProtocol()">‚ñ∂Ô∏è Execute Full Protocol</button>
                <button class="btn btn-small" onclick="stepProtocol()">üë£ Step Through</button>
                <button class="btn btn-small" onclick="resetProtocol()">üîÑ Reset</button>
                
                <div class="exchange-visualization" id="exchangeVisualization">
                    <div class="participant alice">
                        <h4>üë© Alice</h4>
                        <p>Preparing...</p>
                    </div>
                    <div class="arrow">‚áÑ</div>
                    <div class="participant bob">
                        <h4>üë® Bob</h4>
                        <p>Preparing...</p>
                    </div>
                </div>
                
                <div class="result-panel">
                    <h4>üìã Protocol Information:</h4>
                    <div id="protocolInfo">Select a protocol step to see details</div>
                </div>
            </div>
        </div>
        
        <div class="three-column">
            <div class="control-panel alice-panel">
                <h3>üë© Alice's Side</h3>
                
                <div class="control-group">
                    <label>Alice's Private Key (a):</label>
                    <input type="number" id="alicePrivate" placeholder="Auto-generated" readonly>
                </div>
                
                <div class="control-group">
                    <label>Alice's Public Key (A):</label>
                    <input type="text" id="alicePublic" placeholder="g^a mod p" readonly>
                </div>
                
                <button class="btn btn-alice" onclick="generateAliceKeys()">üîë Generate Alice's Keys</button>
                <button class="btn btn-alice btn-small" onclick="calculateAliceShared()">ü§ù Calculate Shared Secret</button>
                
                <div class="key-display">
                    <h4>üîê Alice's Calculations:</h4>
                    <div id="aliceCalculations">Generate keys to see calculations</div>
                </div>
                
                <div class="result-panel alice">
                    <h4>üîí Alice's Shared Secret:</h4>
                    <div id="aliceSharedSecret">Complete key exchange to see shared secret</div>
                </div>
            </div>
            
            <div class="control-panel bob-panel">
                <h3>üë® Bob's Side</h3>
                
                <div class="control-group">
                    <label>Bob's Private Key (b):</label>
                    <input type="number" id="bobPrivate" placeholder="Auto-generated" readonly>
                </div>
                
                <div class="control-group">
                    <label>Bob's Public Key (B):</label>
                    <input type="text" id="bobPublic" placeholder="g^b mod p" readonly>
                </div>
                
                <button class="btn btn-bob" onclick="generateBobKeys()">üîë Generate Bob's Keys</button>
                <button class="btn btn-bob btn-small" onclick="calculateBobShared()">ü§ù Calculate Shared Secret</button>
                
                <div class="key-display">
                    <h4>üîê Bob's Calculations:</h4>
                    <div id="bobCalculations">Generate keys to see calculations</div>
                </div>
                
                <div class="result-panel bob">
                    <h4>üîí Bob's Shared Secret:</h4>
                    <div id="bobSharedSecret">Complete key exchange to see shared secret</div>
                </div>
            </div>
            
            <div class="control-panel eve-panel">
                <h3>üïµÔ∏è Eve's Attack</h3>
                
                <div class="control-group">
                    <label>Attack Type:</label>
                    <select id="attackType">
                        <option value="passive">Passive Eavesdropping</option>
                        <option value="mitm">Man-in-the-Middle</option>
                        <option value="smallsubgroup">Small Subgroup Attack</option>
                        <option value="discrete-log">Discrete Log Attack</option>
                    </select>
                </div>
                
                <button class="btn btn-eve" onclick="simulateAttack()">üîç Simulate Attack</button>
                <button class="btn btn-eve btn-small" onclick="showCountermeasures()">üõ°Ô∏è Countermeasures</button>
                
                <div class="vulnerability-demo">
                    <h4>‚ö†Ô∏è Vulnerability Analysis:</h4>
                    <div id="vulnerabilityAnalysis">Select attack type to see analysis</div>
                </div>
                
                <div class="result-panel eve">
                    <h4>üîì Attack Results:</h4>
                    <div id="attackResults">Execute attack to see results</div>
                </div>
            </div>
        </div>
        
        <div class="demo-grid">
            <div class="control-panel">
                <h3>üßÆ Mathematical Analysis</h3>
                
                <div class="control-group">
                    <label>Compute:</label>
                    <select id="computationType">
                        <option value="modexp">Modular Exponentiation</option>
                        <option value="discretelog">Discrete Logarithm</option>
                        <option value="primitive">Primitive Root Test</option>
                        <option value="order">Element Order</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>Base:</label>
                    <input type="number" id="mathBase" value="5">
                </div>
                
                <div class="control-group">
                    <label>Exponent:</label>
                    <input type="number" id="mathExponent" value="7">
                </div>
                
                <div class="control-group">
                    <label>Modulus:</label>
                    <input type="number" id="mathModulus" value="23">
                </div>
                
                <button class="btn" onclick="performMathCalculation()">üßÆ Calculate</button>
                <button class="btn btn-small" onclick="showMathSteps()">üìù Show Steps</button>
                
                <div class="math-formula">
                    <h4>üî¢ Calculation Result:</h4>
                    <div id="mathResult">Enter values and calculate</div>
                </div>
                
                <div class="result-panel">
                    <h4>üìä Mathematical Properties:</h4>
                    <div id="mathProperties">Perform calculation to see properties</div>
                </div>
            </div>
            
            <div class="control-panel">
                <h3>‚ö° Performance & Security</h3>
                
                <div class="control-group">
                    <label>Security Level:</label>
                    <select id="securityLevel" onchange="updateSecurityInfo()">
                        <option value="512">512 bits (weak)</option>
                        <option value="1024">1024 bits (legacy)</option>
                        <option value="2048" selected>2048 bits (current)</option>
                        <option value="3072">3072 bits (future)</option>
                    </select>
                </div>
                
                <button class="btn" onclick="benchmarkPerformance()">‚ö° Benchmark</button>
                <button class="btn btn-small" onclick="analyzeComplexity()">üìä Complexity Analysis</button>
                
                <div class="security-analysis">
                    <h4>üõ°Ô∏è Security Analysis:</h4>
                    <div id="securityAnalysis">Select security level to see analysis</div>
                </div>
                
                <div class="result-panel">
                    <h4>üìà Performance Metrics:</h4>
                    <div id="performanceMetrics">Run benchmark to see metrics</div>
                </div>
                
                <div class="result-panel">
                    <h4>üåç Real-World Usage:</h4>
                    <div id="realWorldUsage">
                        <p>‚Ä¢ <strong>TLS/SSL:</strong> HTTPS key exchange</p>
                        <p>‚Ä¢ <strong>VPNs:</strong> Secure tunnel establishment</p>
                        <p>‚Ä¢ <strong>SSH:</strong> Secure shell connections</p>
                        <p>‚Ä¢ <strong>IPSec:</strong> Network layer security</p>
                        <p>‚Ä¢ <strong>Signal Protocol:</strong> Messaging security</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="control-panel" style="margin-top: 20px;">
            <h3>üìö Protocol Timeline</h3>
            
            <div class="timeline" id="protocolTimeline">
                <div class="timeline-item" data-step="1">
                    <h4>Public Parameters Agreement</h4>
                    <p>Alice and Bob agree on public prime p and generator g</p>
                </div>
                
                <div class="timeline-item" data-step="2">
                    <h4>Private Key Generation</h4>
                    <p>Each party generates a random private key (a for Alice, b for Bob)</p>
                </div>
                
                <div class="timeline-item" data-step="3">
                    <h4>Public Key Calculation</h4>
                    <p>Alice computes A = g<sup>a</sup> mod p, Bob computes B = g<sup>b</sup> mod p</p>
                </div>
                
                <div class="timeline-item" data-step="4">
                    <h4>Public Key Exchange</h4>
                    <p>Alice sends A to Bob, Bob sends B to Alice (over insecure channel)</p>
                </div>
                
                <div class="timeline-item" data-step="5">
                    <h4>Shared Secret Computation</h4>
                    <p>Alice computes s = B<sup>a</sup> mod p, Bob computes s = A<sup>b</sup> mod p</p>
                </div>
                
                <div class="timeline-item" data-step="6">
                    <h4>Verification</h4>
                    <p>Both parties now have the same shared secret s = g<sup>ab</sup> mod p</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let protocolState = {
            step: 0,
            p: 23,
            g: 5,
            alicePrivate: null,
            bobPrivate: null,
            alicePublic: null,
            bobPublic: null,
            aliceShared: null,
            bobShared: null
        };
        
        function generateParameters() {
            const keySize = document.getElementById('keySize').value;
            
            if (keySize === 'small') {
                // Use small primes for demonstration
                const smallPrimes = [23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97];
                const p = smallPrimes[Math.floor(Math.random() * smallPrimes.length)];
                const g = findPrimitiveRoot(p);
                
                document.getElementById('primeP').value = p;
                document.getElementById('generatorG').value = g;
                
                protocolState.p = p;
                protocolState.g = g;
            } else {
                // Use well-known safe primes for larger key sizes
                alert(`For ${keySize}-bit keys, using RFC standard parameters (too large to display in demo)`);
                protocolState.p = Math.pow(2, parseInt(keySize)) - 1; // Placeholder
                protocolState.g = 2;
            }
            
            analyzeParameters();
        }
        
        function generateWellKnownParams() {
            // RFC 3526 Group 14 (2048-bit) parameters (truncated for demo)
            document.getElementById('primeP').value = 23;
            document.getElementById('generatorG').value = 2;
            
            protocolState.p = 23;
            protocolState.g = 2;
            
            alert('Using simplified RFC parameters for demonstration');
            analyzeParameters();
        }
        
        function findPrimitiveRoot(p) {
            // Find a primitive root modulo p
            for (let g = 2; g < p; g++) {
                if (isPrimitiveRoot(g, p)) {
                    return g;
                }
            }
            return 2; // Fallback
        }
        
        function isPrimitiveRoot(g, p) {
            // Check if g is a primitive root modulo p
            const phi = p - 1; // For prime p, œÜ(p) = p-1
            const factors = getFactors(phi);
            
            for (let factor of factors) {
                if (modPow(g, phi / factor, p) === 1) {
                    return false;
                }
            }
            return true;
        }
        
        function getFactors(n) {
            const factors = [];
            for (let i = 2; i * i <= n; i++) {
                if (n % i === 0) {
                    factors.push(i);
                    if (i !== n / i) {
                        factors.push(n / i);
                    }
                }
            }
            factors.push(n);
            return factors;
        }
        
        function analyzeParameters() {
            const p = parseInt(document.getElementById('primeP').value);
            const g = parseInt(document.getElementById('generatorG').value);
            
            protocolState.p = p;
            protocolState.g = g;
            
            const isPPrime = isPrime(p);
            const isGPrimitive = isPrimitiveRoot(g, p);
            const bitLength = Math.floor(Math.log2(p)) + 1;
            
            document.getElementById('parameterAnalysis').innerHTML = `
                <p><strong>Prime p:</strong> ${p} ${isPPrime ? '‚úÖ' : '‚ùå'}</p>
                <p><strong>Generator g:</strong> ${g} ${isGPrimitive ? '‚úÖ' : '‚ùå'}</p>
                <p><strong>Bit Length:</strong> ${bitLength} bits</p>
                <p><strong>Security Level:</strong> ${getSecurityLevel(bitLength)}</p>
                <p><strong>Group Order:</strong> ${p - 1}</p>
            `;
        }
        
        function isPrime(n) {
            if (n < 2) return false;
            for (let i = 2; i * i <= n; i++) {
                if (n % i === 0) return false;
            }
            return true;
        }
        
        function getSecurityLevel(bits) {
            if (bits < 512) return 'Very Weak';
            if (bits < 1024) return 'Weak';
            if (bits < 2048) return 'Legacy';
            if (bits < 3072) return 'Good';
            return 'Strong';
        }
        
        function updateKeySize() {
            const keySize = document.getElementById('keySize').value;
            if (keySize !== 'small') {
                alert(`${keySize}-bit keys use very large numbers. Demo will use smaller values for visualization.`);
            }
        }
        
        function executeFullProtocol() {
            protocolState.step = 0;
            
            // Step through the entire protocol
            const steps = [
                () => { updateProtocolStep(1); },
                () => { generateAliceKeys(); updateProtocolStep(2); },
                () => { generateBobKeys(); updateProtocolStep(3); },
                () => { updateProtocolStep(4); },
                () => { calculateAliceShared(); calculateBobShared(); updateProtocolStep(5); }
            ];
            
            let stepIndex = 0;
            const interval = setInterval(() => {
                if (stepIndex < steps.length) {
                    steps[stepIndex]();
                    stepIndex++;
                } else {
                    clearInterval(interval);
                    updateVisualization();
                }
            }, 1000);
        }
        
        function stepProtocol() {
            protocolState.step++;
            if (protocolState.step > 5) protocolState.step = 5;
            
            document.getElementById('protocolStep').value = protocolState.step;
            updateProtocolInfo();
            updateProgress();
            
            switch (protocolState.step) {
                case 1:
                case 2:
                    generateAliceKeys();
                    break;
                case 3:
                    generateBobKeys();
                    break;
                case 4:
                    updateVisualization();
                    break;
                case 5:
                    calculateAliceShared();
                    calculateBobShared();
                    break;
            }
        }
        
        function resetProtocol() {
            protocolState = {
                step: 0,
                p: parseInt(document.getElementById('primeP').value),
                g: parseInt(document.getElementById('generatorG').value),
                alicePrivate: null,
                bobPrivate: null,
                alicePublic: null,
                bobPublic: null,
                aliceShared: null,
                bobShared: null
            };
            
            document.getElementById('protocolStep').value = 0;
            document.getElementById('alicePrivate').value = '';
            document.getElementById('alicePublic').value = '';
            document.getElementById('bobPrivate').value = '';
            document.getElementById('bobPublic').value = '';
            
            updateProtocolInfo();
            updateProgress();
            updateVisualization();
        }
        
        function updateProtocolStep(step) {
            protocolState.step = step;
            document.getElementById('protocolStep').value = step;
            updateProtocolInfo();
            updateProgress();
        }
        
        function updateProtocolInfo() {
            const step = parseInt(document.getElementById('protocolStep').value);
            const steps = [
                {
                    title: "Initial Setup",
                    description: "Preparing for key exchange. No communication yet.",
                    details: "Both parties need to agree on the protocol and prepare for communication."
                },
                {
                    title: "Public Parameters",
                    description: "Alice and Bob agree on public prime p and generator g.",
                    details: `Public parameters: p = ${protocolState.p}, g = ${protocolState.g}<br>These can be transmitted in the clear.`
                },
                {
                    title: "Private Key Generation",
                    description: "Each party generates a random private key.",
                    details: "Alice chooses private key 'a', Bob chooses private key 'b'.<br>These MUST be kept secret!"
                },
                {
                    title: "Public Key Calculation",
                    description: "Each party computes their public key.",
                    details: "Alice: A = g^a mod p<br>Bob: B = g^b mod p<br>Public keys can be shared openly."
                },
                {
                    title: "Key Exchange",
                    description: "Parties exchange their public keys over insecure channel.",
                    details: "Alice sends A to Bob<br>Bob sends B to Alice<br>Eavesdroppers can see A and B."
                },
                {
                    title: "Shared Secret",
                    description: "Each party computes the shared secret.",
                    details: "Alice: s = B^a mod p<br>Bob: s = A^b mod p<br>Both get the same value!"
                }
            ];
            
            if (step >= 0 && step < steps.length) {
                const stepInfo = steps[step];
                document.getElementById('protocolInfo').innerHTML = `
                    <h4>${stepInfo.title}</h4>
                    <p><strong>Description:</strong> ${stepInfo.description}</p>
                    <p><strong>Details:</strong> ${stepInfo.details}</p>
                `;
            }
            
            updateProgress();
        }
        
        function updateProgress() {
            const step = parseInt(document.getElementById('protocolStep').value);
            const progress = (step / 5) * 100;
            document.getElementById('protocolProgress').style.width = progress + '%';
        }
        
        function generateAliceKeys() {
            const p = protocolState.p;
            const g = protocolState.g;
            
            // Generate Alice's private key (random number between 2 and p-2)
            protocolState.alicePrivate = Math.floor(Math.random() * (p - 3)) + 2;
            
            // Calculate Alice's public key: A = g^a mod p
            protocolState.alicePublic = modPow(g, protocolState.alicePrivate, p);
            
            document.getElementById('alicePrivate').value = protocolState.alicePrivate;
            document.getElementById('alicePublic').value = protocolState.alicePublic;
            
            document.getElementById('aliceCalculations').innerHTML = `
                <p><strong>Private Key:</strong> a = ${protocolState.alicePrivate}</p>
                <p><strong>Public Key Calculation:</strong></p>
                <p>A = g^a mod p</p>
                <p>A = ${g}^${protocolState.alicePrivate} mod ${p}</p>
                <p>A = ${protocolState.alicePublic}</p>
            `;
            
            updateVisualization();
        }
        
        function generateBobKeys() {
            const p = protocolState.p;
            const g = protocolState.g;
            
            // Generate Bob's private key
            protocolState.bobPrivate = Math.floor(Math.random() * (p - 3)) + 2;
            
            // Calculate Bob's public key: B = g^b mod p
            protocolState.bobPublic = modPow(g, protocolState.bobPrivate, p);
            
            document.getElementById('bobPrivate').value = protocolState.bobPrivate;
            document.getElementById('bobPublic').value = protocolState.bobPublic;
            
            document.getElementById('bobCalculations').innerHTML = `
                <p><strong>Private Key:</strong> b = ${protocolState.bobPrivate}</p>
                <p><strong>Public Key Calculation:</strong></p>
                <p>B = g^b mod p</p>
                <p>B = ${g}^${protocolState.bobPrivate} mod ${p}</p>
                <p>B = ${protocolState.bobPublic}</p>
            `;
            
            updateVisualization();
        }
        
        function calculateAliceShared() {
            if (!protocolState.alicePrivate || !protocolState.bobPublic) {
                alert('Need both private and public keys first!');
                return;
            }
            
            const p = protocolState.p;
            
            // Alice calculates: s = B^a mod p
            protocolState.aliceShared = modPow(protocolState.bobPublic, protocolState.alicePrivate, p);
            
            document.getElementById('aliceSharedSecret').innerHTML = `
                <p><strong>Shared Secret Calculation:</strong></p>
                <p>s = B^a mod p</p>
                <p>s = ${protocolState.bobPublic}^${protocolState.alicePrivate} mod ${p}</p>
                <p><strong>s = ${protocolState.aliceShared}</strong></p>
                <p>${protocolState.aliceShared === protocolState.bobShared ? '‚úÖ Matches Bob!' : '‚ùå Different from Bob'}</p>
            `;
        }
        
        function calculateBobShared() {
            if (!protocolState.bobPrivate || !protocolState.alicePublic) {
                alert('Need both private and public keys first!');
                return;
            }
            
            const p = protocolState.p;
            
            // Bob calculates: s = A^b mod p
            protocolState.bobShared = modPow(protocolState.alicePublic, protocolState.bobPrivate, p);
            
            document.getElementById('bobSharedSecret').innerHTML = `
                <p><strong>Shared Secret Calculation:</strong></p>
                <p>s = A^b mod p</p>
                <p>s = ${protocolState.alicePublic}^${protocolState.bobPrivate} mod ${p}</p>
                <p><strong>s = ${protocolState.bobShared}</strong></p>
                <p>${protocolState.aliceShared === protocolState.bobShared ? '‚úÖ Matches Alice!' : '‚ùå Different from Alice'}</p>
            `;
        }
        
        function updateVisualization() {
            const aliceSection = document.querySelector('.participant.alice p');
            const bobSection = document.querySelector('.participant.bob p');
            
            if (protocolState.alicePublic && protocolState.bobPublic) {
                aliceSection.innerHTML = `Public: ${protocolState.alicePublic}<br>Secret: ${protocolState.aliceShared || '?'}`;
                bobSection.innerHTML = `Public: ${protocolState.bobPublic}<br>Secret: ${protocolState.bobShared || '?'}`;
            } else if (protocolState.alicePublic) {
                aliceSection.innerHTML = `Public: ${protocolState.alicePublic}`;
                bobSection.innerHTML = 'Generating keys...';
            } else {
                aliceSection.innerHTML = 'Preparing...';
                bobSection.innerHTML = 'Preparing...';
            }
        }
        
        function simulateAttack() {
            const attackType = document.getElementById('attackType').value;
            
            switch (attackType) {
                case 'passive':
                    simulatePassiveAttack();
                    break;
                case 'mitm':
                    simulateMITMAttack();
                    break;
                case 'smallsubgroup':
                    simulateSmallSubgroupAttack();
                    break;
                case 'discrete-log':
                    simulateDiscreteLogAttack();
                    break;
            }
        }
        
        function simulatePassiveAttack() {
            document.getElementById('vulnerabilityAnalysis').innerHTML = `
                <p><strong>Passive Eavesdropping Attack:</strong></p>
                <p>Eve can see: p = ${protocolState.p}, g = ${protocolState.g}</p>
                <p>Eve can see: A = ${protocolState.alicePublic || '?'}, B = ${protocolState.bobPublic || '?'}</p>
                <p><strong>Problem:</strong> Eve needs to compute g^(ab) from g^a and g^b</p>
                <p><strong>Difficulty:</strong> This is the Diffie-Hellman problem</p>
            `;
            
            document.getElementById('attackResults').innerHTML = `
                <p><strong>Attack Outcome:</strong> ‚ùå FAILED</p>
                <p>Without private keys, Eve cannot compute the shared secret</p>
                <p>Would need to solve discrete logarithm problem</p>
                <p><strong>Security:</strong> Protected by mathematical difficulty</p>
            `;
        }
        
        function simulateMITMAttack() {
            document.getElementById('vulnerabilityAnalysis').innerHTML = `
                <p><strong>Man-in-the-Middle Attack:</strong></p>
                <p>1. Eve intercepts all communication</p>
                <p>2. Eve generates her own key pair</p>
                <p>3. Eve establishes separate secrets with Alice and Bob</p>
                <p><strong>Vulnerability:</strong> No authentication of public keys</p>
            `;
            
            document.getElementById('attackResults').innerHTML = `
                <p><strong>Attack Outcome:</strong> ‚ö†Ô∏è POSSIBLE</p>
                <p>Eve can decrypt and re-encrypt all messages</p>
                <p><strong>Countermeasure:</strong> Public key authentication</p>
                <p>‚Ä¢ Digital certificates</p>
                <p>‚Ä¢ Pre-shared authentication</p>
                <p>‚Ä¢ Out-of-band verification</p>
            `;
        }
        
        function simulateSmallSubgroupAttack() {
            document.getElementById('vulnerabilityAnalysis').innerHTML = `
                <p><strong>Small Subgroup Attack:</strong></p>
                <p>Eve sends a public key with small order</p>
                <p>This limits possible shared secret values</p>
                <p><strong>Example:</strong> If Eve sends 1, shared secret is always 1</p>
            `;
            
            document.getElementById('attackResults').innerHTML = `
                <p><strong>Attack Outcome:</strong> ‚ö†Ô∏è POSSIBLE</p>
                <p>Can reduce security by limiting shared secret space</p>
                <p><strong>Countermeasures:</strong></p>
                <p>‚Ä¢ Validate received public keys</p>
                <p>‚Ä¢ Ensure keys are in valid range [2, p-2]</p>
                <p>‚Ä¢ Use safe primes: p = 2q + 1</p>
            `;
        }
        
        function simulateDiscreteLogAttack() {
            const p = protocolState.p;
            const difficulty = Math.pow(p, 0.5); // Square root complexity for demo
            
            document.getElementById('vulnerabilityAnalysis').innerHTML = `
                <p><strong>Discrete Logarithm Attack:</strong></p>
                <p>Goal: Find 'a' such that g^a ‚â° A (mod p)</p>
                <p>Best known algorithms: Pollard's rho, Index calculus</p>
                <p><strong>Complexity:</strong> O(‚àöp) for small primes</p>
                <p><strong>For p = ${p}:</strong> ~${Math.floor(difficulty)} operations</p>
            `;
            
            let attackSuccess = false;
            if (p < 100 && protocolState.alicePrivate) {
                // Try brute force for small primes
                for (let i = 1; i < p; i++) {
                    if (modPow(protocolState.g, i, p) === protocolState.alicePublic) {
                        attackSuccess = true;
                        break;
                    }
                }
            }
            
            document.getElementById('attackResults').innerHTML = `
                <p><strong>Attack Outcome:</strong> ${attackSuccess ? '‚úÖ SUCCESS (small prime)' : '‚ùå INFEASIBLE'}</p>
                <p>${attackSuccess ? 'Found private key by brute force' : 'Would take too long for larger primes'}</p>
                <p><strong>Real-world:</strong> Use primes with 2048+ bits</p>
                <p><strong>Quantum threat:</strong> Shor's algorithm breaks this</p>
            `;
        }
        
        function showCountermeasures() {
            document.getElementById('attackResults').innerHTML = `
                <h5>üõ°Ô∏è Security Countermeasures:</h5>
                <p><strong>Authentication:</strong> Verify public key ownership</p>
                <p><strong>Safe Primes:</strong> Use p = 2q + 1 where q is prime</p>
                <p><strong>Key Validation:</strong> Check 1 < key < p-1</p>
                <p><strong>Strong Parameters:</strong> 2048+ bit primes</p>
                <p><strong>Forward Secrecy:</strong> Generate new keys per session</p>
                <p><strong>Post-Quantum:</strong> Prepare for quantum computers</p>
            `;
        }
        
        function performMathCalculation() {
            const computation = document.getElementById('computationType').value;
            const base = parseInt(document.getElementById('mathBase').value);
            const exponent = parseInt(document.getElementById('mathExponent').value);
            const modulus = parseInt(document.getElementById('mathModulus').value);
            
            let result, steps, properties;
            
            switch (computation) {
                case 'modexp':
                    result = modPow(base, exponent, modulus);
                    steps = `${base}^${exponent} mod ${modulus} = ${result}`;
                    properties = `Used in public key generation`;
                    break;
                case 'discretelog':
                    result = discreteLog(base, exponent, modulus);
                    steps = `log_${base}(${exponent}) mod ${modulus} = ${result || 'not found'}`;
                    properties = `This is the hard problem DH relies on`;
                    break;
                case 'primitive':
                    result = isPrimitiveRoot(base, modulus);
                    steps = `${base} is ${result ? '' : 'not '}a primitive root mod ${modulus}`;
                    properties = `Primitive roots generate all non-zero elements`;
                    break;
                case 'order':
                    result = findOrder(base, modulus);
                    steps = `ord_${modulus}(${base}) = ${result}`;
                    properties = `Order determines the cycle length`;
                    break;
            }
            
            document.getElementById('mathResult').innerHTML = `
                <p><strong>Result:</strong> ${steps}</p>
            `;
            
            document.getElementById('mathProperties').innerHTML = `
                <p><strong>Explanation:</strong> ${properties}</p>
                <p><strong>Relevance:</strong> ${getRelevanceExplanation(computation)}</p>
            `;
        }
        
        function discreteLog(g, h, p) {
            // Brute force for small numbers only
            if (p > 100) return null;
            
            for (let x = 1; x < p; x++) {
                if (modPow(g, x, p) === h) {
                    return x;
                }
            }
            return null;
        }
        
        function findOrder(a, n) {
            if (gcd(a, n) !== 1) return 0;
            
            for (let i = 1; i < n; i++) {
                if (modPow(a, i, n) === 1) {
                    return i;
                }
            }
            return n - 1;
        }
        
        function gcd(a, b) {
            while (b !== 0) {
                const temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }
        
        function getRelevanceExplanation(computation) {
            switch (computation) {
                case 'modexp':
                    return 'Core operation in key generation and shared secret computation';
                case 'discretelog':
                    return 'The hard problem that makes Diffie-Hellman secure';
                case 'primitive':
                    return 'Ensures generator creates a large cyclic group';
                case 'order':
                    return 'Determines the security of the chosen generator';
                default:
                    return '';
            }
        }
        
        function showMathSteps() {
            const base = parseInt(document.getElementById('mathBase').value);
            const exponent = parseInt(document.getElementById('mathExponent').value);
            const modulus = parseInt(document.getElementById('mathModulus').value);
            
            // Show binary exponentiation steps
            let steps = `Binary representation of ${exponent}: ${exponent.toString(2)}\n`;
            steps += `Computing ${base}^${exponent} mod ${modulus} using square-and-multiply:\n\n`;
            
            let result = 1;
            let currentPower = base % modulus;
            const binaryExp = exponent.toString(2).split('').reverse();
            
            for (let i = 0; i < binaryExp.length; i++) {
                if (binaryExp[i] === '1') {
                    steps += `Bit ${i}: result = (${result} * ${currentPower}) mod ${modulus} = ${(result * currentPower) % modulus}\n`;
                    result = (result * currentPower) % modulus;
                }
                if (i < binaryExp.length - 1) {
                    steps += `Square: ${currentPower}^2 mod ${modulus} = ${(currentPower * currentPower) % modulus}\n`;
                    currentPower = (currentPower * currentPower) % modulus;
                }
            }
            
            alert(steps);
        }
        
        function benchmarkPerformance() {
            const iterations = 1000;
            const testBase = 2;
            const testExp = 1000;
            const testMod = 2047;
            
            const startTime = performance.now();
            for (let i = 0; i < iterations; i++) {
                modPow(testBase, testExp, testMod);
            }
            const endTime = performance.now();
            
            const totalTime = endTime - startTime;
            const avgTime = totalTime / iterations;
            
            document.getElementById('performanceMetrics').innerHTML = `
                <p><strong>Test:</strong> ${iterations} modular exponentiations</p>
                <p><strong>Total Time:</strong> ${totalTime.toFixed(2)} ms</p>
                <p><strong>Average Time:</strong> ${avgTime.toFixed(4)} ms per operation</p>
                <p><strong>Rate:</strong> ${Math.floor(1000 / avgTime)} operations/second</p>
                <p><em>Note: Browser-based, actual crypto libraries are much faster</em></p>
            `;
        }
        
        function analyzeComplexity() {
            document.getElementById('performanceMetrics').innerHTML = `
                <h5>üìä Complexity Analysis:</h5>
                <p><strong>Key Generation:</strong> O(log n) where n is the exponent</p>
                <p><strong>Discrete Log:</strong> O(‚àöp) for general algorithms</p>
                <p><strong>Best Classical:</strong> Sub-exponential (index calculus)</p>
                <p><strong>Quantum:</strong> Polynomial (Shor's algorithm)</p>
                <p><strong>Recommended:</strong> 2048-bit primes for 112-bit security</p>
            `;
        }
        
        function updateSecurityInfo() {
            const level = document.getElementById('securityLevel').value;
            
            let classical, quantum, recommendation;
            
            switch (level) {
                case '512':
                    classical = '~60 bits'; quantum = '~30 bits'; recommendation = 'Broken - do not use';
                    break;
                case '1024':
                    classical = '~80 bits'; quantum = '~40 bits'; recommendation = 'Legacy only';
                    break;
                case '2048':
                    classical = '~112 bits'; quantum = '~56 bits'; recommendation = 'Current standard';
                    break;
                case '3072':
                    classical = '~128 bits'; quantum = '~64 bits'; recommendation = 'Future-proof';
                    break;
            }
            
            document.getElementById('securityAnalysis').innerHTML = `
                <p><strong>Bit Length:</strong> ${level} bits</p>
                <p><strong>Classical Security:</strong> ${classical}</p>
                <p><strong>Quantum Security:</strong> ${quantum}</p>
                <p><strong>Recommendation:</strong> ${recommendation}</p>
                <p><strong>Time to Break:</strong> ${getTimeEstimate(level)}</p>
            `;
        }
        
        function getTimeEstimate(bits) {
            const operations = Math.pow(2, parseInt(bits) * 0.7); // Approximation
            const rate = 1e15; // Operations per second for powerful computer
            const years = operations / rate / (365 * 24 * 3600);
            
            if (years < 1) return 'Less than a year';
            if (years < 1000) return `~${Math.floor(years)} years`;
            if (years < 1e6) return `~${Math.floor(years/1000)} thousand years`;
            if (years < 1e9) return `~${Math.floor(years/1e6)} million years`;
            return `~${(years/1e9).toExponential(1)} billion years`;
        }
        
        // Modular exponentiation using binary method
        function modPow(base, exp, mod) {
            let result = 1;
            base = base % mod;
            while (exp > 0) {
                if (exp % 2 === 1) {
                    result = (result * base) % mod;
                }
                exp = Math.floor(exp / 2);
                base = (base * base) % mod;
            }
            return result;
        }
        
        // Initialize
        window.onload = function() {
            analyzeParameters();
            updateProtocolInfo();
            updateSecurityInfo();
            
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        };
    </script>
</body>
</html>
