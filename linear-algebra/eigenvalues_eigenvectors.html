<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·ªã Ri√™ng & Vec-t∆° Ri√™ng - L√Ω Thuy·∫øt To√°n H·ªçc & Gi·∫£i Th√≠ch H√¨nh H·ªçc</title>
    <style>
        body {
            margin: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-y: auto;
            font-size: 18px;
            line-height: 1.7;
        }
        
        .container {
            display: flex;
            min-height: 600px; /* Fixed minimum height for visualization */
        }
        
        .canvas-container {
            flex: 1;
            position: relative;
        }
        
        canvas {
            background: #000;
            border: 1px solid #444;
        }
        
        .controls {
            width: 420px;
            background: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-left: 2px solid rgba(255, 255, 255, 0.3);
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        
        .control-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .control-section h3 {
            margin: 0 0 20px 0;
            color: #00FFFF;
            font-size: 1.4em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        .matrix-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .matrix-input input {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            text-align: center;
            font-size: 1.1em;
            font-weight: 600;
            backdrop-filter: blur(5px);
        }
        
        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .preset-buttons button {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .preset-buttons button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }
        
        .eigenvalue-display {
            background: rgba(0, 255, 255, 0.1);
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .eigenvalue {
            margin: 8px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .real-eigenvalue {
            border-left: 3px solid #e74c3c;
        }
        
        .complex-eigenvalue {
            border-left: 3px solid #9b59b6;
        }
        
        .toggle-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .toggle-button {
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .toggle-button.active {
            background: #00FFFF;
            color: #000000;
            font-weight: 800;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.4);
        }
        
        
        .legend {
            font-size: 11px;
            margin-top: 8px;
            line-height: 1.4;
        }
        
        .legend-item {
            margin: 3px 0;
        }
        
        .slider-group {
            margin: 10px 0;
        }
        
        .slider-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            color: #aaa;
        }
        
        .slider-group input[type="range"] {
            width: 100%;
        }
        
        .slider-value {
            font-size: 12px;
            color: #0ff;
            text-align: right;
            margin-top: 2px;
        }
        
        .footer-legend {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            border-top: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            font-size: 14px;
            font-weight: 600;
            margin-top: 20px;
        }
        
        .footer-legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .header-section {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 25px 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .header-section h1 {
            margin: 0 0 15px 0;
            font-size: 1.8em;
            color: #00FFFF;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        .header-section p {
            margin: 8px 0;
            font-size: 1.1em;
            line-height: 1.6;
        }
    </style>





</head>
<body>
    <!-- Header Section with Mathematical Explanation -->
    <div class="header-section">
        <h1>üîç Ph√¢n T√≠ch Tr·ªã Ri√™ng - N·ªÅn T·∫£ng To√°n H·ªçc</h1>
        <p><strong>üéØ Kh√°i Ni·ªám C∆° B·∫£n:</strong> V·ªõi ma tr·∫≠n A, n·∫øu Av = Œªv v·ªõi vec-t∆° v kh√°c kh√¥ng, th√¨ Œª l√† tr·ªã ri√™ng v√† v l√† vec-t∆° ri√™ng t∆∞∆°ng ·ª©ng.</p>
        <p><strong>üí° √ù Nghƒ©a H√¨nh H·ªçc:</strong> Ph√©p bi·∫øn ƒë·ªïi b·∫£o to√†n h∆∞·ªõng d·ªçc vec-t∆° ri√™ng</p>
        
        <div style="background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #FFD700;">
            <h2 style="margin: 0 0 10px 0; color: #FFD700; font-size: 1.3em;">üìê C√°ch T√¨m Gi√° Tr·ªã Ri√™ng & Vector Ri√™ng</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                <div>
                    <h3 style="color: #00FFFF; font-size: 1.1em; margin: 10px 0 5px 0;">üî¢ B∆∞·ªõc 1: T√¨m Gi√° Tr·ªã Ri√™ng</h3>
                    <p style="font-size: 0.95em; margin: 5px 0;">1. L·∫≠p ph∆∞∆°ng tr√¨nh ƒë·∫∑c tr∆∞ng: <strong>det(A - ŒªI) = 0</strong></p>
                    <p style="font-size: 0.95em; margin: 5px 0;">2. V·ªõi ma tr·∫≠n 2√ó2: <strong>det([a-Œª, b; c, d-Œª]) = 0</strong></p>
                    <p style="font-size: 0.95em; margin: 5px 0;">3. Khai tri·ªÉn: <strong>(a-Œª)(d-Œª) - bc = 0</strong></p>
                    <p style="font-size: 0.95em; margin: 5px 0;">4. Gi·∫£i ph∆∞∆°ng tr√¨nh b·∫≠c 2 ƒë·ªÉ t√¨m Œª‚ÇÅ, Œª‚ÇÇ</p>
                </div>
                
                <div>
                    <h3 style="color: #2ecc71; font-size: 1.1em; margin: 10px 0 5px 0;">üìê B∆∞·ªõc 2: T√¨m Vector Ri√™ng</h3>
                    <p style="font-size: 0.95em; margin: 5px 0;">1. V·ªõi m·ªói Œª·µ¢, gi·∫£i h·ªá: <strong>(A - Œª·µ¢I)v = 0</strong></p>
                    <p style="font-size: 0.95em; margin: 5px 0;">2. Thi·∫øt l·∫≠p ma tr·∫≠n m·ªü r·ªông v√† kh·ª≠ Gauss</p>
                    <p style="font-size: 0.95em; margin: 5px 0;">3. T√¨m kh√¥ng gian nghi·ªám (null space)</p>
                    <p style="font-size: 0.95em; margin: 5px 0;">4. Chu·∫©n h√≥a vector ƒë·ªÉ c√≥ ƒë·ªô d√†i ƒë∆°n v·ªã</p>
                </div>
            </div>
            
            <div style="background: rgba(52, 152, 219, 0.1); padding: 12px; border-radius: 8px; margin-top: 15px;">
                <h3 style="color: #3498db; font-size: 1.1em; margin: 0 0 8px 0;">üßÆ V√≠ D·ª• C·ª• Th·ªÉ</h3>
                <p style="font-size: 0.9em; margin: 3px 0;"><strong>Ma tr·∫≠n A = [2, 1; 1, 2]</strong></p>
                <p style="font-size: 0.9em; margin: 3px 0;">‚Ä¢ Ph∆∞∆°ng tr√¨nh ƒë·∫∑c tr∆∞ng: (2-Œª)¬≤ - 1 = 0 ‚Üí Œª¬≤ - 4Œª + 3 = 0</p>
                <p style="font-size: 0.9em; margin: 3px 0;">‚Ä¢ Gi√° tr·ªã ri√™ng: Œª‚ÇÅ = 3, Œª‚ÇÇ = 1</p>
                <p style="font-size: 0.9em; margin: 3px 0;">‚Ä¢ Vector ri√™ng Œª‚ÇÅ=3: v‚ÇÅ = [1, 1]·µÄ (h∆∞·ªõng y=x)</p>
                <p style="font-size: 0.9em; margin: 3px 0;">‚Ä¢ Vector ri√™ng Œª‚ÇÇ=1: v‚ÇÇ = [1, -1]·µÄ (h∆∞·ªõng y=-x)</p>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="canvas-container">
            <canvas id="canvas" width="800" height="600"></canvas>
        </div>
        
        <div class="controls">
            <div class="control-section">
                <h3>Nh·∫≠p Ma Tr·∫≠n 2√ó2</h3>
                <div class="matrix-input">
                    <input type="number" id="a11" step="0.1" value="2" placeholder="a‚ÇÅ‚ÇÅ">
                    <input type="number" id="a12" step="0.1" value="1" placeholder="a‚ÇÅ‚ÇÇ">
                    <input type="number" id="a21" step="0.1" value="1" placeholder="a‚ÇÇ‚ÇÅ">
                    <input type="number" id="a22" step="0.1" value="2" placeholder="a‚ÇÇ‚ÇÇ">
                </div>
                <div class="preset-buttons">
                    <button onclick="loadPreset('identity')">Ma Tr·∫≠n ƒê∆°n V·ªã</button>
                    <button onclick="loadPreset('diagonal')">Ma Tr·∫≠n Ch√©o</button>
                    <button onclick="loadPreset('symmetric')">Ma Tr·∫≠n ƒê·ªëi X·ª©ng</button>
                    <button onclick="loadPreset('rotation')">Xoay</button>
                    <button onclick="loadPreset('shear')">Tr∆∞·ª£t</button>
                    <button onclick="loadPreset('reflection')">Ph·∫£n X·∫°</button>
                </div>
            </div>
            
            <div class="control-section">
                <h3>T√≠nh Ch·∫•t Ma Tr·∫≠n</h3>
                <div style="font-family: 'Courier New', monospace; font-size: 13px;">
                    <div>Ma tr·∫≠n A:</div>
                    <div style="text-align: center; margin: 10px 0;">
                        [<span id="display_a11">2.0</span>  <span id="display_a12">1.0</span>]<br>
                        [<span id="display_a21">1.0</span>  <span id="display_a22">2.0</span>]
                    </div>
                    <div>ƒê·ªãnh th·ª©c: <span id="determinant">3.0</span></div>
                    <div>V·∫øt: <span id="trace">4.0</span></div>
                </div>
            </div>
            
            <div class="control-section">
                <h3>Tr·ªã Ri√™ng & Vec-t∆° Ri√™ng</h3>
                <div id="eigenvalues-display" class="eigenvalue-display">
                    <!-- Eigenvalues will be displayed here -->
                </div>
            </div>
            
            <div class="control-section">
                <h3>T√πy Ch·ªçn Hi·ªÉn Th·ªã</h3>
                <div class="toggle-section">
                    <div class="toggle-button active" id="toggle-circle" onclick="toggleVisualization('circle')">
                        ƒê∆∞·ªùng Tr√≤n ƒê∆°n V·ªã
                    </div>
                    <div class="toggle-button" id="toggle-grid" onclick="toggleVisualization('grid')">
                        L∆∞·ªõi Vec-t∆°
                    </div>
                    <div class="toggle-button active" id="toggle-eigenvectors" onclick="toggleVisualization('eigenvectors')">
                        Vec-t∆° Ri√™ng
                    </div>
                    <div class="toggle-button active" id="toggle-eigenlines" onclick="toggleVisualization('eigenlines')">
                        ƒê∆∞·ªùng Ri√™ng
                    </div>
                </div>
            </div>
            
            <div class="control-section">
                <h3>Ho·∫°t ·∫¢nh</h3>
                <div class="slider-group">
                    <label>T·ªëc ƒê·ªô Ho·∫°t ·∫¢nh:</label>
                    <input type="range" id="animSpeed" min="0" max="2" step="0.1" value="1">
                    <div class="slider-value" id="animSpeedValue">1.0</div>
                </div>
                <div class="toggle-section">
                    <div class="toggle-button" id="toggle-animation" onclick="toggleAnimation()">
                        ‚ñ∂ Ch∆°i Ho·∫°t ·∫¢nh
                    </div>
                    <div class="toggle-button" onclick="resetVisualization()">
                        üîÑ ƒê·∫∑t L·∫°i
                    </div>
                </div>
            </div>
            
            <!-- Mathematical Theory Section -->
            <div class="control-section">
                <h3>üìê L√Ω Thuy·∫øt To√°n H·ªçc</h3>
                <div style="background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>üîç ƒêa Th·ª©c ƒê·∫∑c Tr∆∞ng:</h4>
                    <p><strong>det(A - ŒªI) = 0</strong><br>
                    ‚Ä¢ ƒê·ªëi v·ªõi ma tr·∫≠n 2√ó2: Œª¬≤ - tr(A)Œª + det(A) = 0<br>
                    ‚Ä¢ V·∫øt tr(A) = a‚ÇÅ‚ÇÅ + a‚ÇÇ‚ÇÇ<br>
                    ‚Ä¢ ƒê·ªãnh th·ª©c det(A) = a‚ÇÅ‚ÇÅa‚ÇÇ‚ÇÇ - a‚ÇÅ‚ÇÇa‚ÇÇ‚ÇÅ</p>
                    
                    <h4>üìä C√°c Lo·∫°i Tr·ªã Ri√™ng:</h4>
                    <ul style="font-size: 12px;">
                        <li><strong>Œª > 1:</strong> K√©o gi√£n theo h∆∞·ªõng vec-t∆° ri√™ng</li>
                        <li><strong>0 < Œª < 1:</strong> Co l·∫°i theo h∆∞·ªõng vec-t∆° ri√™ng</li>
                        <li><strong>Œª < 0:</strong> Ph·∫£n x·∫° + t·ª∑ l·ªá</li>
                        <li><strong>Œª ph·ª©c:</strong> Xoay + t·ª∑ l·ªá</li>
                    </ul>
                </div>
                
                <div style="background: rgba(0, 123, 255, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>‚öôÔ∏è T√≠nh Ch·∫•t Ma Tr·∫≠n:</h4>
                    <p><strong>Ch√©o h√≥a:</strong><br>
                    N·∫øu A c√≥ n vec-t∆° ri√™ng ƒë·ªôc l·∫≠p tuy·∫øn t√≠nh: A = PDP‚Åª¬π</p>
                    
                    <p><strong>ƒê·ªãnh l√Ω Ph·ªï:</strong><br>
                    Ma tr·∫≠n ƒë·ªëi x·ª©ng lu√¥n c√≥ tr·ªã ri√™ng th·ª±c v√† vec-t∆° ri√™ng tr·ª±c giao</p>
                    
                    <p><strong>V·∫øt & ƒê·ªãnh th·ª©c:</strong><br>
                    tr(A) = Œª‚ÇÅ + Œª‚ÇÇ, det(A) = Œª‚ÇÅ ¬∑ Œª‚ÇÇ</p>
                </div>
                
                <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>üßÆ ·ª®ng D·ª•ng trong To√°n H·ªçc:</h4>
                    <ul style="font-size: 12px;">
                        <li><strong>Ph∆∞∆°ng Tr√¨nh Vi Ph√¢n:</strong> Kh√¥ng gian nghi·ªám v√† ph√¢n t√≠ch ·ªïn ƒë·ªãnh</li>
                        <li><strong>D·∫°ng To√†n Ph∆∞∆°ng:</strong> Ph√¢n lo·∫°i c√°c thi·∫øt di·ªán c√¥nic</li>
                        <li><strong>L√Ω Thuy·∫øt ƒê·ªì Th·ªã:</strong> Ph·ªï ma tr·∫≠n k·ªÅ c·∫≠n</li>
                        <li><strong>Ph√¢n T√≠ch Dao ƒê·ªông:</strong> T·∫ßn s·ªë t·ª± nhi√™n v√† d·∫°ng dao ƒë·ªông</li>
                    </ul>
                </div>
                
                <div style="background: rgba(220, 53, 69, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>üî¨ Gi·∫£i Th√≠ch H√¨nh H·ªçc:</h4>
                    <p><strong>√ù Nghƒ©a Tr·ªã Ri√™ng:</strong><br>
                    ‚Ä¢ Œª > 0: B·∫£o to√†n h∆∞·ªõng, t·ª∑ l·ªá theo h·ªá s·ªë Œª<br>
                    ‚Ä¢ Œª < 0: ƒê·∫£o ng∆∞·ª£c h∆∞·ªõng, t·ª∑ l·ªá theo h·ªá s·ªë |Œª|<br>
                    ‚Ä¢ Œª ph·ª©c: K·∫øt h·ª£p xoay v√† t·ª∑ l·ªá</p>
                    
                    <h4>‚ö° Th√≠ Nghi·ªám To√°n H·ªçc:</h4>
                    <ol style="font-size: 12px;">
                        <li>Ma tr·∫≠n ƒë∆°n v·ªã ‚Üí T·∫•t c·∫£ tr·ªã ri√™ng = 1 (kh√¥ng thay ƒë·ªïi)</li>
                        <li>Ma tr·∫≠n ch√©o ‚Üí Tr·ªã ri√™ng = ph·∫ßn t·ª≠ ƒë∆∞·ªùng ch√©o</li>
                        <li>Ma tr·∫≠n xoay ‚Üí Tr·ªã ri√™ng ph·ª©c (hi·ªáu ·ª©ng xoay)</li>
                        <li>Ma tr·∫≠n ƒë·ªëi x·ª©ng ‚Üí Tr·ªã ri√™ng th·ª±c, vec-t∆° ri√™ng tr·ª±c giao</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        const width = canvas.width;
        const height = canvas.height;
        const centerX = width / 2;
        const centerY = height / 2;
        const scale = 100;
        
        // Matrix elements
        let matrix = {
            a11: 2, a12: 1,
            a21: 1, a22: 2
        };
        
        // Eigenvalue calculation results
        let eigendata = {
            eigenvalues: [],
            eigenvectors: [],
            isReal: true
        };
        
        // Animation state
        let animationId = null;
        let animationTime = 0;
        let animationSpeed = 1;
        let isAnimating = false;
        
        // Visualization options
        let showOptions = {
            circle: true,
            grid: false,
            eigenvectors: true,
            eigenlines: true
        };
        
        function toCanvasX(x) {
            return centerX + x * scale;
        }
        
        function toCanvasY(y) {
            return centerY - y * scale;
        }
        
        function applyMatrix(point) {
            return {
                x: matrix.a11 * point.x + matrix.a12 * point.y,
                y: matrix.a21 * point.x + matrix.a22 * point.y
            };
        }
        
        function calculateEigenvalues() {
            const a = matrix.a11;
            const b = matrix.a12;
            const c = matrix.a21;
            const d = matrix.a22;
            
            // Characteristic polynomial: Œª¬≤ - trace¬∑Œª + det = 0
            const trace = a + d;
            const det = a * d - b * c;
            const discriminant = trace * trace - 4 * det;
            
            let eigenvalues = [];
            let eigenvectors = [];
            let isReal = discriminant >= 0;
            
            if (isReal) {
                const sqrt_disc = Math.sqrt(discriminant);
                const lambda1 = (trace + sqrt_disc) / 2;
                const lambda2 = (trace - sqrt_disc) / 2;
                
                eigenvalues = [lambda1, lambda2];
                
                // Calculate eigenvectors
                for (let lambda of eigenvalues) {
                    let v1, v2;
                    
                    // Try (A - ŒªI)v = 0
                    const m11 = a - lambda;
                    const m12 = b;
                    const m21 = c;
                    const m22 = d - lambda;
                    
                    if (Math.abs(m12) > 1e-10) {
                        v1 = 1;
                        v2 = -m11 / m12;
                    } else if (Math.abs(m21) > 1e-10) {
                        v1 = -m22 / m21;
                        v2 = 1;
                    } else if (Math.abs(m11) < 1e-10 && Math.abs(m22) < 1e-10) {
                        // Any vector is an eigenvector
                        v1 = 1;
                        v2 = 0;
                    } else {
                        v1 = 1;
                        v2 = 0;
                    }
                    
                    // Normalize
                    const norm = Math.sqrt(v1 * v1 + v2 * v2);
                    eigenvectors.push({ x: v1 / norm, y: v2 / norm });
                }
            } else {
                const realPart = trace / 2;
                const imagPart = Math.sqrt(-discriminant) / 2;
                eigenvalues = [
                    { real: realPart, imag: imagPart },
                    { real: realPart, imag: -imagPart }
                ];
                
                // For complex eigenvalues, we can still show the real eigenvectors if they exist
                // Or show the rotation behavior
                eigenvectors = [
                    { x: 1, y: 0 },
                    { x: 0, y: 1 }
                ];
            }
            
            eigendata = { eigenvalues, eigenvectors, isReal };
            updateEigenvalueDisplay();
        }
        
        function updateEigenvalueDisplay() {
            const display = document.getElementById('eigenvalues-display');
            let html = '';
            
            if (eigendata.isReal) {
                eigendata.eigenvalues.forEach((lambda, i) => {
                    const v = eigendata.eigenvectors[i];
                    html += `<div class="eigenvalue real-eigenvalue">
                        <strong>Œª${i+1} = ${lambda.toFixed(3)}</strong><br/>
                        v${i+1} = [${v.x.toFixed(3)}, ${v.y.toFixed(3)}]<br/>
                        <small>${lambda > 1 ? 'Stretches' : lambda < -1 ? 'Stretches & flips' : lambda > 0 ? 'Shrinks' : 'Shrinks & flips'} along this direction</small>
                    </div>`;
                });
            } else {
                const lambda = eigendata.eigenvalues[0];
                html = `<div class="eigenvalue complex-eigenvalue">
                    <strong>Œª = ${lambda.real.toFixed(3)} ¬± ${Math.abs(lambda.imag).toFixed(3)}i</strong><br/>
                    <small>Complex eigenvalues ‚Üí Rotation + Scaling</small><br/>
                    <small>|Œª| = ${(Math.sqrt(lambda.real*lambda.real + lambda.imag*lambda.imag)).toFixed(3)}</small><br/>
                    <small>Angle = ${(Math.atan2(lambda.imag, lambda.real) * 180 / Math.PI).toFixed(1)}¬∞</small>
                </div>`;
            }
            
            display.innerHTML = html;
        }
        
        function drawGrid() {
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 1;
            
            for (let i = -10; i <= 10; i++) {
                // Vertical lines
                ctx.beginPath();
                ctx.moveTo(toCanvasX(i), 0);
                ctx.lineTo(toCanvasX(i), height);
                ctx.stroke();
                
                // Horizontal lines
                ctx.beginPath();
                ctx.moveTo(0, toCanvasY(i));
                ctx.lineTo(width, toCanvasY(i));
                ctx.stroke();
            }
            
            // Axes
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
        }
        
        function drawCircle() {
            const numPoints = 100;
            const originalPoints = [];
            const transformedPoints = [];
            
            for (let i = 0; i < numPoints; i++) {
                const angle = (i / numPoints) * 2 * Math.PI;
                const point = { x: Math.cos(angle), y: Math.sin(angle) };
                originalPoints.push(point);
                transformedPoints.push(applyMatrix(point));
            }
            
            // Draw original circle
            ctx.strokeStyle = '#0ff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i < originalPoints.length; i++) {
                const p = originalPoints[i];
                if (i === 0) {
                    ctx.moveTo(toCanvasX(p.x), toCanvasY(p.y));
                } else {
                    ctx.lineTo(toCanvasX(p.x), toCanvasY(p.y));
                }
            }
            ctx.closePath();
            ctx.stroke();
            
            // Draw transformed shape
            ctx.strokeStyle = '#f39c12';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let i = 0; i < transformedPoints.length; i++) {
                const p = transformedPoints[i];
                if (i === 0) {
                    ctx.moveTo(toCanvasX(p.x), toCanvasY(p.y));
                } else {
                    ctx.lineTo(toCanvasX(p.x), toCanvasY(p.y));
                }
            }
            ctx.closePath();
            ctx.stroke();
        }
        
        function drawVectorGrid() {
            const gridSize = 6;
            const spacing = 0.5;
            
            for (let x = -gridSize; x <= gridSize; x += spacing) {
                for (let y = -gridSize; y <= gridSize; y += spacing) {
                    const orig = { x, y };
                    const trans = applyMatrix(orig);
                    
                    drawArrow(orig, trans, '#9b59b6', 1);
                }
            }
        }
        
        function drawArrow(from, to, color, lineWidth = 2) {
            const fromX = toCanvasX(from.x);
            const fromY = toCanvasY(from.y);
            const toX = toCanvasX(to.x);
            const toY = toCanvasY(to.y);
            
            ctx.strokeStyle = color;
            ctx.lineWidth = lineWidth;
            
            // Arrow body
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();
            
            // Arrow head
            const angle = Math.atan2(toY - fromY, toX - fromX);
            const headLength = 8;
            
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(
                toX - headLength * Math.cos(angle - Math.PI / 6),
                toY - headLength * Math.sin(angle - Math.PI / 6)
            );
            ctx.moveTo(toX, toY);
            ctx.lineTo(
                toX - headLength * Math.cos(angle + Math.PI / 6),
                toY - headLength * Math.sin(angle + Math.PI / 6)
            );
            ctx.stroke();
        }
        
        function drawEigenvectors() {
            if (!eigendata.isReal) return;
            
            const colors = ['#e74c3c', '#2ecc71'];
            
            eigendata.eigenvectors.forEach((v, i) => {
                const lambda = eigendata.eigenvalues[i];
                const length = Math.min(3, Math.max(0.5, Math.abs(lambda)));
                
                // Draw eigenvector line
                const end = { x: v.x * length, y: v.y * length };
                const start = { x: -v.x * length, y: -v.y * length };
                
                if (showOptions.eigenlines) {
                    ctx.strokeStyle = colors[i];
                    ctx.setLineDash([5, 5]);
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(toCanvasX(start.x), toCanvasY(start.y));
                    ctx.lineTo(toCanvasX(end.x), toCanvasY(end.y));
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
                
                if (showOptions.eigenvectors) {
                    // Draw eigenvector arrow
                    drawArrow({ x: 0, y: 0 }, end, colors[i], 3);
                    
                    // Draw eigenvalue effect
                    const transformed = { x: v.x * lambda, y: v.y * lambda };
                    drawArrow({ x: 0, y: 0 }, transformed, colors[i], 2);
                    
                    // Label
                    ctx.fillStyle = colors[i];
                    ctx.font = '12px Arial';
                    ctx.fillText(`Œª${i+1}=${lambda.toFixed(2)}`, 
                        toCanvasX(end.x) + 10, 
                        toCanvasY(end.y) - 10
                    );
                }
            });
        }
        
        function draw() {
            ctx.clearRect(0, 0, width, height);
            
            drawGrid();
            
            if (showOptions.circle) {
                drawCircle();
            }
            
            if (showOptions.grid) {
                drawVectorGrid();
            }
            
            if (showOptions.eigenvectors || showOptions.eigenlines) {
                drawEigenvectors();
            }
        }
        
        function updateMatrix() {
            matrix.a11 = parseFloat(document.getElementById('a11').value) || 0;
            matrix.a12 = parseFloat(document.getElementById('a12').value) || 0;
            matrix.a21 = parseFloat(document.getElementById('a21').value) || 0;
            matrix.a22 = parseFloat(document.getElementById('a22').value) || 0;
            
            // Update display
            document.getElementById('display_a11').textContent = matrix.a11.toFixed(1);
            document.getElementById('display_a12').textContent = matrix.a12.toFixed(1);
            document.getElementById('display_a21').textContent = matrix.a21.toFixed(1);
            document.getElementById('display_a22').textContent = matrix.a22.toFixed(1);
            
            const det = matrix.a11 * matrix.a22 - matrix.a12 * matrix.a21;
            const trace = matrix.a11 + matrix.a22;
            
            document.getElementById('determinant').textContent = det.toFixed(3);
            document.getElementById('trace').textContent = trace.toFixed(3);
            
            calculateEigenvalues();
            draw();
        }
        
        function loadPreset(type) {
            const presets = {
                identity: [1, 0, 0, 1],
                diagonal: [3, 0, 0, 1],
                symmetric: [2, 1, 1, 2],
                rotation: [Math.cos(Math.PI/4), -Math.sin(Math.PI/4), Math.sin(Math.PI/4), Math.cos(Math.PI/4)],
                shear: [1, 1, 0, 1],
                reflection: [1, 0, 0, -1]
            };
            
            const values = presets[type];
            document.getElementById('a11').value = values[0];
            document.getElementById('a12').value = values[1];
            document.getElementById('a21').value = values[2];
            document.getElementById('a22').value = values[3];
            
            updateMatrix();
        }
        
        function toggleVisualization(option) {
            showOptions[option] = !showOptions[option];
            const button = document.getElementById(`toggle-${option}`);
            button.classList.toggle('active', showOptions[option]);
            draw();
        }
        
        function toggleAnimation() {
            isAnimating = !isAnimating;
            const button = document.getElementById('toggle-animation');
            
            if (isAnimating) {
                button.textContent = '‚è∏ Pause';
                animate();
            } else {
                button.textContent = '‚ñ∂ Play Animation';
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            }
        }
        
        function animate() {
            if (!isAnimating) return;
            
            animationTime += 0.02 * animationSpeed;
            
            // Animate by interpolating between identity and the matrix
            const t = (Math.sin(animationTime) + 1) / 2; // 0 to 1
            
            const originalMatrix = { ...matrix };
            matrix.a11 = 1 + t * (originalMatrix.a11 - 1);
            matrix.a12 = t * originalMatrix.a12;
            matrix.a21 = t * originalMatrix.a21;
            matrix.a22 = 1 + t * (originalMatrix.a22 - 1);
            
            calculateEigenvalues();
            draw();
            
            matrix = originalMatrix; // Restore original matrix
            
            animationId = requestAnimationFrame(animate);
        }
        
        function resetVisualization() {
            isAnimating = false;
            animationTime = 0;
            document.getElementById('toggle-animation').textContent = '‚ñ∂ Play Animation';
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            updateMatrix();
        }
        
        // Event listeners
        document.getElementById('a11').addEventListener('input', updateMatrix);
        document.getElementById('a12').addEventListener('input', updateMatrix);
        document.getElementById('a21').addEventListener('input', updateMatrix);
        document.getElementById('a22').addEventListener('input', updateMatrix);
        
        document.getElementById('animSpeed').addEventListener('input', function() {
            animationSpeed = parseFloat(this.value);
            document.getElementById('animSpeedValue').textContent = animationSpeed.toFixed(1);
        });
        
        // Initialize
        updateMatrix();
        draw();
    </script>
    
    <!-- Footer Legend -->
    <div class="footer-legend">
        <div class="footer-legend-item">
            <span style="color: #0ff;">üîµ</span>
            <span>ƒê∆∞·ªùng Tr√≤n ƒê∆°n V·ªã (G·ªëc)</span>
        </div>
        <div class="footer-legend-item">
            <span style="color: #f39c12;">üü†</span>
            <span>H√¨nh D·∫°ng Bi·∫øn ƒê·ªïi</span>
        </div>
        <div class="footer-legend-item">
            <span style="color: #e74c3c;">üî¥</span>
            <span>Vec-t∆° Ri√™ng Th·ª© Nh·∫•t Œª‚ÇÅ</span>
        </div>
        <div class="footer-legend-item">
            <span style="color: #2ecc71;">üü¢</span>
            <span>Vec-t∆° Ri√™ng Th·ª© Hai Œª‚ÇÇ</span>
        </div>
        <div class="footer-legend-item">
            <span style="color: #9b59b6;">üü£</span>
            <span>L∆∞·ªõi Vec-t∆°</span>
        </div>
    </div>
</body>
</html>